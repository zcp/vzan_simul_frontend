# ä¸“é¢˜åŠŸèƒ½å®Œæ•´è®¾è®¡æ–‡æ¡£ (ä¿®æ­£ç‰ˆ)

## ç‰ˆæœ¬ä¿¡æ¯
- **ç‰ˆæœ¬**: V1.0 (ä¿®æ­£ç‰ˆ)
- **åŸºäº**: ç›´æ’­æ ¸å¿ƒåŠŸèƒ½è®¾è®¡æ–‡æ¡£ V3.2
- **ä¿®è®¢æ—¥æœŸ**: 2025-10-15
- **çŠ¶æ€**: è®¾è®¡å®šç¨¿

---

## ğŸ“š **é‡è¦æç¤ºï¼šå¼€å‘è§„èŒƒå¼•ç”¨**

**æœ¬æ–‡æ¡£ä¸“æ³¨äº"ä¸“é¢˜èšåˆåŠŸèƒ½"çš„å…·ä½“è®¾è®¡ï¼Œæ‰€æœ‰å¼€å‘è§„èŒƒã€ç¼–ç è§„èŒƒã€æ—¥å¿—è§„èŒƒã€å¼‚å¸¸å¤„ç†è§„èŒƒç­‰é€šç”¨è§„èŒƒï¼Œå‡å®Œå…¨éµå¾ªå¹¶ç»§æ‰¿è‡ªï¼š**

### **ğŸ“– æ ¸å¿ƒè§„èŒƒæ–‡æ¡£**
> **æ–‡æ¡£**: `docs/03_ç³»ç»Ÿè®¾è®¡/ç›´æ’­æ ¸å¿ƒåŠŸèƒ½è®¾è®¡æ–‡æ¡£v3-åœ¨å¢åŠ jwt tokenå’ŒssoåŸºç¡€ä¸Šå¢åŠ ç›´æ’­é—´å°é¢ä¸Šä¼ å’Œè¿”å›å›æ”¾åœ°å€.md`  
> **ç‰ˆæœ¬**: V3.2

### **ğŸ“‹ å¿…é¡»éµå¾ªçš„æ ¸å¿ƒè§„èŒƒï¼ˆå®Œæ•´åˆ—è¡¨ï¼‰**

AIåœ¨ç”Ÿæˆä»£ç æ—¶ï¼Œå¿…é¡»åŒæ—¶å‚è€ƒä»¥ä¸‹ä¸¤ä»½æ–‡æ¡£ï¼š
1. **æœ¬æ–‡æ¡£**ï¼šä¸“é¢˜åŠŸèƒ½çš„å…·ä½“APIã€æ•°æ®åº“ã€Schemaå®šä¹‰
2. **æ ¸å¿ƒåŠŸèƒ½æ–‡æ¡£**ï¼šæ‰€æœ‰é€šç”¨è§„èŒƒå’Œæ ‡å‡†

---

#### **1. å¼€å‘è§„èŒƒ (æ ¸å¿ƒæ–‡æ¡£ Section 1)**
è¯·å®Œæ•´å‚è€ƒæ ¸å¿ƒæ–‡æ¡£çš„ä»¥ä¸‹ç« èŠ‚ï¼š

##### **1.1 ä»£ç è§„èŒƒ**
- **å¼€å‘è¯­è¨€**: Python 3.8+
- **ä»£ç é£æ ¼**: ä¸¥æ ¼éµå¾ª PEP 8
- **æ ¼å¼åŒ–**: 4ä¸ªç©ºæ ¼ç¼©è¿›ï¼ŒUTF-8ç¼–ç 
- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 1.1

##### **1.2 å‘½åè§„èŒƒ**
- **ç±»å**: å¤§é©¼å³°å‘½åæ³• (PascalCase)ï¼Œä¾‹å¦‚ `Topic`, `TopicCategory`
- **å‡½æ•°/æ–¹æ³•**: ä¸‹åˆ’çº¿å‘½åæ³• (snake_case)ï¼Œä¾‹å¦‚ `create_topic`, `get_topic_detail`
- **å˜é‡**: ä¸‹åˆ’çº¿å‘½åæ³•ï¼Œä¾‹å¦‚ `topic_id`, `user_id`
- **å¸¸é‡**: å…¨å¤§å†™ä¸‹åˆ’çº¿å‘½åæ³•ï¼Œä¾‹å¦‚ `MAX_TOPIC_TITLE_LENGTH`
- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 1.2

##### **1.3 é¡¹ç›®ç»“æ„è§„èŒƒ**
```
backend/live_core_service/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ models/          # æ•°æ®åº“æ¨¡å‹ï¼ˆæ·»åŠ  Topic, TopicCategory, TopicCategoryRoomï¼‰
â”‚   â”œâ”€â”€ schemas/         # Pydantic Schemaï¼ˆæ·»åŠ  topic.pyï¼‰
â”‚   â”œâ”€â”€ crud/            # æ•°æ®è®¿é—®å±‚ï¼ˆæ·»åŠ  topic.pyï¼‰
â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆæ·»åŠ  topic_service.pyï¼‰
â”‚   â”œâ”€â”€ api/v1/endpoints/# APIç«¯ç‚¹ï¼ˆæ·»åŠ  topic.pyï¼‰
â”‚   â”œâ”€â”€ core/            # æ ¸å¿ƒé…ç½®ï¼ˆå¤ç”¨ auth.py, deps.pyï¼‰
â”‚   â””â”€â”€ exceptions/      # å¼‚å¸¸å®šä¹‰ï¼ˆæ·»åŠ ä¸“é¢˜ç›¸å…³å¼‚å¸¸ï¼‰
```
- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 1.3

##### **1.4 æµ‹è¯•è§„èŒƒ**
- **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**: >80%
- **æ‰€æœ‰å…¬å¼€API**: å¿…é¡»æœ‰å®Œæ•´æµ‹è¯•ç”¨ä¾‹
- **æµ‹è¯•æ–‡ä»¶å‘½å**: `test_<module_name>.py`
- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 1.4

---

#### **2. æ—¥å¿—ä¸å¼‚å¸¸å¤„ç†è§„èŒƒ (æ ¸å¿ƒæ–‡æ¡£ Section 2)**

##### **2.1 æ—¥å¿—è§„èŒƒ**
```python
# æ—¥å¿—çº§åˆ«ä½¿ç”¨ï¼ˆä¸æ ¸å¿ƒæ–‡æ¡£å®Œå…¨ä¸€è‡´ï¼‰
logger.error("ä¸“é¢˜åˆ›å»ºå¤±è´¥: user_id={}, error={}", user_id, str(e))   # å…³é”®é”™è¯¯
logger.warning("ä¸“é¢˜åˆ é™¤: topic_id={}, categories_count={}", ...)      # åˆ é™¤æ“ä½œ
logger.info("ä¸“é¢˜åˆ›å»ºæˆåŠŸ: topic_id={}, title={}", topic.id, ...)      # é‡è¦æ“ä½œ
logger.debug("ä¸“é¢˜åˆ—è¡¨æŸ¥è¯¢: page={}, size={}, filters={}", ...)        # è°ƒè¯•ä¿¡æ¯
```
- **æ—¥å¿—æ ¼å¼**: æ—¶é—´æˆ³(ISO 8601) + çº§åˆ« + æ¨¡å—å + å‡½æ•°å + æ¶ˆæ¯
- **æ•æ„Ÿä¿¡æ¯è„±æ•**: å¯†ç ã€Tokenç­‰å¿…é¡»è„±æ•
- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 2.1

##### **2.2 å¼‚å¸¸å¤„ç†è§„èŒƒ**
```python
# å¼‚å¸¸åˆ†ç±»ï¼ˆä¸æ ¸å¿ƒæ–‡æ¡£å®Œå…¨ä¸€è‡´ï¼‰
- ç³»ç»Ÿå¼‚å¸¸: DatabaseConnectionError, RedisConnectionError
- ä¸šåŠ¡å¼‚å¸¸: TopicNotFoundException, TopicPermissionDeniedException
- å‚æ•°å¼‚å¸¸: ValidationError (Pydanticè‡ªåŠ¨å¤„ç†)
- æƒé™å¼‚å¸¸: UnauthorizedException, ForbiddenException
```

**ç»Ÿä¸€å¼‚å¸¸å“åº”æ ¼å¼ï¼š**
```json
{
  "code": 2003,
  "message": "æ“ä½œè¢«ç¦æ­¢",
  "data": {
    "resource_id": "topic_uuid_123",
    "current_status": "published",
    "reason": "æ— æ³•åˆ é™¤å·²å‘å¸ƒçš„ä¸“é¢˜"
  },
  "timestamp": "2025-10-15T14:40:00Z"
}
```
- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 2.2

---

#### **3. é€šç”¨ API è§„èŒƒ (æ ¸å¿ƒæ–‡æ¡£ Section 4)**

##### **3.1 é€šç”¨å“åº”ç»“æ„**
æ‰€æœ‰APIæ¥å£å¿…é¡»ä½¿ç”¨ä»¥ä¸‹ç»Ÿä¸€ç»“æ„ï¼š
```json
{
  "code": 200,           // ä¸šåŠ¡çŠ¶æ€ç 
  "message": "success",  // ç®€è¦è¯´æ˜
  "data": {...},         // æ ¸å¿ƒæ•°æ®
  "timestamp": "2025-10-15T10:00:00Z"  // ISO 8601æ ¼å¼
}
```
- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 4.1

##### **3.2 çŠ¶æ€ç çº¦å®š**
| HTTPçŠ¶æ€ç  | ä¸šåŠ¡çŠ¶æ€ç  | è¯´æ˜ |
|-----------|-----------|------|
| 200 | 200 | æˆåŠŸ |
| 400 | 4xxx | å‚æ•°æ ¡éªŒé”™è¯¯ |
| 401 | 401 | æœªè®¤è¯ |
| 403 | 2003 | æƒé™ä¸è¶³ |
| 404 | 2001 | èµ„æºä¸å­˜åœ¨ |
| 500 | 1xxx | ç³»ç»Ÿé”™è¯¯ |
- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 4.2

##### **3.3 åˆ†é¡µæ ¼å¼çº¦å®š**
```json
{
  "code": 200,
  "data": {
    "total": 100,    // æ€»è®°å½•æ•°
    "page": 1,       // å½“å‰é¡µç 
    "size": 10,      // æ¯é¡µæ¡æ•°
    "items": [...]   // æ•°æ®åˆ—è¡¨
  }
}
```
- **Queryå‚æ•°**: `page`(é»˜è®¤1), `size`(é»˜è®¤10,æœ€å¤§100), `sort`(å¦‚`created_at:desc`)
- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 4.3

---

#### **4. æ•°æ®åº“è®¾è®¡è§„èŒƒ (æ ¸å¿ƒæ–‡æ¡£ Section 7.1)**

##### **4.1 è®¾è®¡åŸåˆ™ï¼ˆä¸“é¢˜è¡¨å¿…é¡»éµå¾ªï¼‰**
- **UUID ä¸»é”®**: æ‰€æœ‰è¡¨ä¸»é”®ä½¿ç”¨ UUIDï¼Œåœ¨åº”ç”¨å±‚é€šè¿‡ `uuid.uuid4()` ç”Ÿæˆ
- **æ—¶åŒºå…¼å®¹**: æ‰€æœ‰æ—¶é—´æˆ³ä½¿ç”¨ `TIMESTAMPTZ`ï¼Œä»¥ UTC å­˜å‚¨
- **æ•°æ®å®Œæ•´æ€§**: ä½¿ç”¨ `UNIQUE`, `ENUM` ä¿è¯æ•°æ®å‡†ç¡®
- **ç”¨æˆ·IDéªŒè¯**: `user_id` é€šè¿‡JWT Tokenåº”ç”¨å±‚éªŒè¯ä¿è¯å¼•ç”¨å®Œæ•´æ€§
- **çº§è”åˆ é™¤**: ä½¿ç”¨ `ON DELETE CASCADE` ä¿è¯æ•°æ®ä¸€è‡´æ€§
- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 7.1

##### **4.2 ç´¢å¼•è®¾è®¡åŸåˆ™**
- **å¤–é”®å­—æ®µ**: å¿…é¡»åˆ›å»ºç´¢å¼•ï¼ˆå¦‚ `idx_topics_user_id`ï¼‰
- **å¸¸ç”¨æŸ¥è¯¢å­—æ®µ**: åˆ›å»ºç´¢å¼•ï¼ˆå¦‚ `idx_topics_status`ï¼‰
- **æ’åºå­—æ®µ**: åˆ›å»ºç´¢å¼•ï¼ˆå¦‚ `idx_topics_created_at`ï¼‰
- **ç»„åˆç´¢å¼•**: æŒ‰æŸ¥è¯¢é¢‘ç‡åˆ›å»ºï¼ˆå¦‚ `idx_tcr_on_category_sort`ï¼‰

---

#### **5. èº«ä»½è®¤è¯ä¸æˆæƒä½“ç³» (æ ¸å¿ƒæ–‡æ¡£ Section 9)**

##### **5.1 JWT TokenéªŒè¯æµç¨‹**
```python
# æ‰€æœ‰APIç«¯ç‚¹å¿…é¡»åŒ…å«ï¼ˆä¸“é¢˜APIä¹Ÿå¿…é¡»ï¼‰
@router.post("/topics")
async def create_topic(
    topic_in: TopicCreate,
    current_user: dict = Depends(get_current_user),  # JWTéªŒè¯
    db: AsyncSession = Depends(get_db)
):
    # 1. get_current_user è‡ªåŠ¨éªŒè¯Token
    # 2. æå– user_id = current_user["user_id"]
    # 3. åˆ›å»ºèµ„æºæ—¶å…³è” user_id
    pass
```
- **Tokenæ ¼å¼**: `Authorization: Bearer <JWT_TOKEN>`
- **Tokenè¿‡æœŸæ—¶é—´**: 30åˆ†é’Ÿ
- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 9.1-9.4

##### **5.2 æƒé™éªŒè¯æµç¨‹**
```python
# Serviceå±‚æƒé™éªŒè¯ï¼ˆä¸“é¢˜Serviceå¿…é¡»éµå¾ªï¼‰
async def update_topic(self, topic_id: UUID, user_id: UUID, ...):
    # 1. æŸ¥è¯¢èµ„æº
    topic = await crud_topic.get(db, topic_id)
    
    # 2. æƒé™éªŒè¯
    if topic.user_id != user_id:
        raise TopicPermissionDeniedException("ä¿®æ”¹")
    
    # 3. æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    ...
```
- **æƒé™è§„åˆ™**: ç”¨æˆ·åªèƒ½ä¿®æ”¹/åˆ é™¤è‡ªå·±åˆ›å»ºçš„èµ„æº
- **æ•°æ®éš”ç¦»**: ç™»å½•ç”¨æˆ·å¯æŸ¥çœ‹æ‰€æœ‰æ•°æ®ï¼Œä½†åªèƒ½æ“ä½œè‡ªå·±çš„æ•°æ®
- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 9.3, 9.7

---

#### **6. æŠ€æœ¯æ ˆä¸å·¥å…· (æ ¸å¿ƒæ–‡æ¡£ Section 5)**

| åˆ†ç±» | æŠ€æœ¯é€‰å‹ | ç”¨é€” |
|-----|---------|------|
| æœåŠ¡ç«¯æ¡†æ¶ | FastAPI | æ„å»ºå¼‚æ­¥ RESTful API |
| ORM | SQLAlchemy 2.0 (å¼‚æ­¥) | æ•°æ®åº“äº¤äº’ |
| æ•°æ®æ¨¡å‹ | Pydantic | æ•°æ®éªŒè¯å’Œåºåˆ—åŒ– |
| æ•°æ®åº“ | PostgreSQL | æŒä¹…åŒ–å­˜å‚¨ |
| ç¼“å­˜ | Redis | Celeryæ¶ˆæ¯ä¸­é—´ä»¶ |
| åå°ä»»åŠ¡ | Celery + gevent | å¼‚æ­¥ä»»åŠ¡å¤„ç† |
| èº«ä»½è®¤è¯ | JWT | æ— çŠ¶æ€è®¤è¯ |

- **è¯¦è§**: æ ¸å¿ƒæ–‡æ¡£ Section 5

---

#### **7. ä»£ç å®ç°å…³é”®ç‚¹**

##### **7.1 å¼‚æ­¥ç¼–ç¨‹è§„èŒƒ**
```python
# æ‰€æœ‰æ•°æ®åº“æ“ä½œå¿…é¡»ä½¿ç”¨ async/await
async def create_topic(db: AsyncSession, topic_in: TopicCreate, user_id: UUID):
    topic = Topic(
        id=uuid.uuid4(),  # åº”ç”¨å±‚ç”ŸæˆUUID
        user_id=user_id,
        **topic_in.dict()
    )
    db.add(topic)
    await db.commit()      # å¼‚æ­¥æäº¤
    await db.refresh(topic)  # å¼‚æ­¥åˆ·æ–°
    return topic
```

##### **7.2 äº‹åŠ¡å¤„ç†è§„èŒƒ**
```python
# ä½¿ç”¨try-except-finallyç¡®ä¿äº‹åŠ¡ä¸€è‡´æ€§
async def complex_operation(db: AsyncSession):
    try:
        # ä¸šåŠ¡æ“ä½œ
        topic = await crud_topic.create(...)
        category = await crud_category.create(...)
        await db.commit()
    except Exception as e:
        await db.rollback()  # å›æ»šäº‹åŠ¡
        logger.error(f"æ“ä½œå¤±è´¥: {str(e)}")
        raise
    finally:
        # æ¸…ç†èµ„æº
        pass
```

##### **7.3 åˆ†å±‚æ¶æ„è§„èŒƒ**
```
APIå±‚ (endpoint)
  â†“ è°ƒç”¨
Serviceå±‚ (business logic)
  â†“ è°ƒç”¨
CRUDå±‚ (database access)
  â†“ æ“ä½œ
Modelå±‚ (database tables)
```
- **æƒé™éªŒè¯**: ä»…åœ¨Serviceå±‚è¿›è¡Œ
- **æ•°æ®éªŒè¯**: Pydanticåœ¨APIå±‚è‡ªåŠ¨éªŒè¯
- **äº‹åŠ¡ç®¡ç†**: åœ¨Serviceå±‚ç»Ÿä¸€ç®¡ç†

---

### **ğŸ“Œ AIä»£ç ç”Ÿæˆæ—¶çš„æ£€æŸ¥æ¸…å•**

ç”Ÿæˆä¸“é¢˜åŠŸèƒ½ä»£ç æ—¶ï¼ŒAIå¿…é¡»ç¡®è®¤ï¼š

#### **æ•°æ®åº“å±‚é¢**
- [ ] è¡¨åä½¿ç”¨ä¸‹åˆ’çº¿å‘½åï¼ˆ`topics`, `topic_categories`ï¼‰
- [ ] ä¸»é”®ä¸ºUUIDç±»å‹ï¼Œåº”ç”¨å±‚ç”Ÿæˆ
- [ ] æ‰€æœ‰æ—¶é—´æˆ³ä½¿ç”¨TIMESTAMPTZ
- [ ] statuså­—æ®µä½¿ç”¨ENUMç±»å‹
- [ ] åŒ…å«user_idå­—æ®µå’Œç´¢å¼•
- [ ] å¤–é”®ä½¿ç”¨ON DELETE CASCADE
- [ ] æ‰€æœ‰è¡¨åŒ…å«created_atå’Œupdated_at

#### **APIå±‚é¢**
- [ ] æ‰€æœ‰ç«¯ç‚¹éœ€è¦JWT Tokenè®¤è¯
- [ ] ä½¿ç”¨ç»Ÿä¸€å“åº”ç»“æ„ï¼ˆcode, message, data, timestampï¼‰
- [ ] åˆ†é¡µæ¥å£ä½¿ç”¨æ ‡å‡†æ ¼å¼ï¼ˆtotal, page, size, itemsï¼‰
- [ ] HTTPçŠ¶æ€ç å’Œä¸šåŠ¡çŠ¶æ€ç æ­£ç¡®å¯¹åº”
- [ ] å®ç°æµç¨‹åŒ…å«å®Œæ•´çš„9-10æ­¥ï¼ˆJWTéªŒè¯ã€æƒé™æ£€æŸ¥ã€æ—¥å¿—è®°å½•ç­‰ï¼‰

#### **ä»£ç å±‚é¢**
- [ ] ç±»åä½¿ç”¨å¤§é©¼å³°ï¼ˆTopicService, TopicCreateï¼‰
- [ ] å‡½æ•°åä½¿ç”¨ä¸‹åˆ’çº¿ï¼ˆcreate_topic, get_topic_detailï¼‰
- [ ] æ‰€æœ‰æ•°æ®åº“æ“ä½œä½¿ç”¨async/await
- [ ] æƒé™éªŒè¯åœ¨Serviceå±‚è¿›è¡Œ
- [ ] å¼‚å¸¸ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±»
- [ ] æ—¥å¿—è®°å½•ç¬¦åˆè§„èŒƒï¼ˆåŒ…å«user_id, resource_id, actionï¼‰

#### **æµ‹è¯•å±‚é¢**
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡>80%
- [ ] æ¯ä¸ªAPIæ¥å£æœ‰é›†æˆæµ‹è¯•
- [ ] æµ‹è¯•ä½¿ç”¨AAAæ¨¡å¼ï¼ˆArrange, Act, Assertï¼‰
- [ ] Mockä½¿ç”¨AsyncMockå¤„ç†å¼‚æ­¥
- [ ] æµ‹è¯•åŒ…å«ä¸­æ–‡æ³¨é‡Šè¯´æ˜

---

### **ğŸ¯ ä½¿ç”¨å»ºè®®**

**åœºæ™¯1ï¼šAIç”ŸæˆCRUDä»£ç **
```
æç¤ºè¯ï¼šè¯·æ ¹æ®ä»¥ä¸‹ä¸¤ä»½æ–‡æ¡£ç”Ÿæˆä¸“é¢˜CRUDä»£ç ï¼š
1. æ ¸å¿ƒè§„èŒƒï¼šdocs/03_ç³»ç»Ÿè®¾è®¡/ç›´æ’­æ ¸å¿ƒåŠŸèƒ½è®¾è®¡æ–‡æ¡£v4-å¢åŠ ä¸“é¢˜.md
2. ä¸“é¢˜è®¾è®¡ï¼šdocs/03_ç³»ç»Ÿè®¾è®¡/ä¸“é¢˜åŠŸèƒ½å®Œæ•´è®¾è®¡æ–‡æ¡£-ä¿®æ­£ç‰ˆ.md

è¦æ±‚ï¼š
- ä¸¥æ ¼éµå¾ªæ ¸å¿ƒæ–‡æ¡£çš„æ‰€æœ‰å¼€å‘è§„èŒƒ
- å®ç°ä¸“é¢˜æ–‡æ¡£ä¸­å®šä¹‰çš„APIæ¥å£
- åŒ…å«å®Œæ•´çš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•
```

**åœºæ™¯2ï¼šAIç”Ÿæˆæµ‹è¯•ä»£ç **
```
æç¤ºè¯ï¼šè¯·æ ¹æ®ä»¥ä¸‹æ–‡æ¡£ç”Ÿæˆä¸“é¢˜åŠŸèƒ½çš„æµ‹è¯•ä»£ç ï¼š
1. æ ¸å¿ƒè§„èŒƒï¼šdocs/03_ç³»ç»Ÿè®¾è®¡/ç›´æ’­æ ¸å¿ƒåŠŸèƒ½è®¾è®¡æ–‡æ¡£v4-å¢åŠ ä¸“é¢˜.mdï¼ˆå‚è€ƒæµ‹è¯•è§„èŒƒï¼‰
2. ä¸“é¢˜è®¾è®¡ï¼šdocs/03_ç³»ç»Ÿè®¾è®¡/ä¸“é¢˜åŠŸèƒ½å®Œæ•´è®¾è®¡æ–‡æ¡£-ä¿®æ­£ç‰ˆ.mdï¼ˆå®ç°APIæµ‹è¯•ï¼‰

è¦æ±‚ï¼š
- æµ‹è¯•é£æ ¼ä¸ç°æœ‰æµ‹è¯•ä¿æŒä¸€è‡´
- ä½¿ç”¨ä¸­æ–‡æ³¨é‡Š
- è¦†ç›–æ‰€æœ‰APIç«¯ç‚¹
```

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šæ•°æ®åº“è®¾è®¡

### 7.3. ä¸“é¢˜èšåˆæ¨¡å‹ (æ–°å¢)

ä¸ºå®ç°ç±»ä¼¼å†…å®¹èšåˆé¡µé¢çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œå°†å¤šä¸ªç›´æ’­é—´ç»„ç»‡åˆ°ä¸€ä¸ªå¸¦æœ‰ç»Ÿä¸€æ¨ªå¹…çš„æ´»åŠ¨ä¸‹ï¼‰ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªç‹¬ç«‹äºæ ¸å¿ƒä¸šåŠ¡è¡¨çš„"ç»„ç»‡å±‚"ã€‚è¯¥æ¨¡å‹ç”±ä¸‰ä¸ªæ–°è¡¨æ„æˆï¼Œå®ƒä»¬è´Ÿè´£å®šä¹‰å†…å®¹çš„ç»„ç»‡å’Œå‘ˆç°æ–¹å¼ï¼Œè€Œä¸ä¼šä¿®æ”¹ä»»ä½•ç°æœ‰çš„è¡¨ç»“æ„ï¼Œå®Œå…¨éµå¾ª"å¼€é—­åŸåˆ™"ã€‚

#### **è®¾è®¡åŸåˆ™**:
* **ç»„ç»‡ä¸å†…å®¹åˆ†ç¦»**: `topics` (ä¸“é¢˜) å’Œ `topic_categories` (ä¸“é¢˜å†…åˆ†ç±») è´Ÿè´£å†…å®¹çš„ç»„ç»‡ç»“æ„ï¼›`live_rooms` è¡¨ä¾ç„¶åªè´Ÿè´£ç›´æ’­é—´è‡ªèº«çš„æ ¸å¿ƒä¸šåŠ¡æ•°æ®ã€‚
* **å¤šå¯¹å¤šå…³è”**: é€šè¿‡ä¸€ä¸ªçº¯ç²¹çš„å…³è”è¡¨ `topic_category_rooms`ï¼Œå®ç°ç›´æ’­é—´ä¸ä¸“é¢˜åˆ†ç±»çš„çµæ´»å…³è”ï¼Œå…è®¸åŒä¸€ä¸ªç›´æ’­é—´è¢«æ”¶å½•åˆ°å¤šä¸ªä¸åŒçš„ä¸“é¢˜æ´»åŠ¨ä¸­ã€‚
* **è§„èŒƒä¸€è‡´æ€§**: æ–°å¢å„è¡¨ä¸¥æ ¼éµå¾ªæ–‡æ¡£ä¸­å·²å®šä¹‰çš„ UUID ä¸»é”®ï¼ˆåº”ç”¨å±‚ç”Ÿæˆï¼‰ã€`TIMESTAMPTZ` æ—¶é—´æˆ³ã€ENUM ç±»å‹ã€å‘½åè§„èŒƒç­‰åŸåˆ™ã€‚
* **ç”¨æˆ·æƒé™éš”ç¦»**: æ‰€æœ‰ä¸šåŠ¡å®ä½“è¡¨åŒ…å« `user_id` å­—æ®µï¼Œé€šè¿‡JWT Tokenåº”ç”¨å±‚éªŒè¯ä¿è¯å¼•ç”¨å®Œæ•´æ€§å’Œæ•°æ®éš”ç¦»ã€‚

---

### 7.3.1. Schema DDL (ä¿®æ­£ç‰ˆ)

```sql
-- LiveCore Service - ä¸“é¢˜èšåˆæ¨¡å‹ Schema (V3.2 æ–°å¢ - ä¿®æ­£ç‰ˆ)

-- æšä¸¾ç±»å‹å®šä¹‰
CREATE TYPE topic_status AS ENUM ('draft', 'published', 'archived');

-- è¡¨ 4: topics (ä¸“é¢˜è¡¨ - é¡¶å±‚å®ä½“)
CREATE TABLE topics (
    -- æ ¸å¿ƒæ ‡è¯† (åœ¨åº”ç”¨å±‚é€šè¿‡ uuid.uuid4() ç”Ÿæˆ)
    id UUID PRIMARY KEY,
    
    -- ç”¨æˆ·IDï¼Œé€šè¿‡JWT Tokenåº”ç”¨å±‚éªŒè¯ä¿è¯å¼•ç”¨å®Œæ•´æ€§
    -- ç”±äºé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œuser_idæ— æ³•è·¨æ•°æ®åº“å¤–é”®å…³è”ï¼Œé€šè¿‡JWT TokenéªŒè¯ç”¨æˆ·å­˜åœ¨æ€§
    user_id UUID NOT NULL,
    
    title VARCHAR(100) NOT NULL,
    description TEXT,
    banner_url VARCHAR(255),
    
    -- ä¸“é¢˜çŠ¶æ€: draft(è‰ç¨¿), published(å·²å‘å¸ƒ), archived(å·²å½’æ¡£)
    status topic_status NOT NULL DEFAULT 'draft',

    -- æ—¶é—´æˆ³å­—æ®µï¼šä½¿ç”¨æ•°æ®åº“çº§é»˜è®¤å€¼ï¼ˆå¯¹åº” SQLAlchemy çš„ server_default=func.now()ï¼‰
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_topics_user_id ON topics(user_id);
CREATE INDEX idx_topics_status ON topics(status);
CREATE INDEX idx_topics_created_at ON topics(created_at DESC);

COMMENT ON TABLE topics IS 'ä¸“é¢˜æ´»åŠ¨è¡¨ï¼Œç”¨äºèšåˆå¤šä¸ªåˆ†ç±»å’Œç›´æ’­é—´ï¼Œå®ç°ç±»ä¼¼èšåˆé¡µé¢çš„åŠŸèƒ½ã€‚';
COMMENT ON COLUMN topics.user_id IS 'åˆ›å»ºè€…ç”¨æˆ·IDï¼Œé€šè¿‡JWT Tokenåº”ç”¨å±‚éªŒè¯';
COMMENT ON COLUMN topics.status IS 'ä¸“é¢˜çŠ¶æ€: draft(è‰ç¨¿), published(å·²å‘å¸ƒ), archived(å·²å½’æ¡£)';

-- è¡¨ 5: topic_categories (ä¸“é¢˜å†…åˆ†ç±»è¡¨ - ä¸­å±‚å®ä½“)
CREATE TABLE topic_categories (
    -- æ ¸å¿ƒæ ‡è¯† (åœ¨åº”ç”¨å±‚é€šè¿‡ uuid.uuid4() ç”Ÿæˆ)
    id UUID PRIMARY KEY,
    
    topic_id UUID NOT NULL REFERENCES topics(id) ON DELETE CASCADE,
    name VARCHAR(50) NOT NULL,
    sort_order INT DEFAULT 0,

    -- æ—¶é—´æˆ³å­—æ®µï¼šä½¿ç”¨æ•°æ®åº“çº§é»˜è®¤å€¼ï¼ˆå¯¹åº” SQLAlchemy çš„ server_default=func.now()ï¼‰
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_topic_categories_on_topic_id ON topic_categories(topic_id);
CREATE INDEX idx_topic_categories_on_sort_order ON topic_categories(topic_id, sort_order);

COMMENT ON TABLE topic_categories IS 'ä¸“é¢˜ä¸‹çš„åˆ†ç±»è¡¨ï¼Œå¦‚æŒ‰çœä»½ã€æŒ‰ç§‘å®¤ç­‰ã€‚ä¸€ä¸ªä¸“é¢˜å¯ä»¥åŒ…å«å¤šä¸ªåˆ†ç±»ã€‚';
COMMENT ON COLUMN topic_categories.sort_order IS 'åˆ†ç±»çš„æ˜¾ç¤ºé¡ºåºï¼Œæ•°å€¼è¶Šå°è¶Šé å‰';

-- è¡¨ 6: topic_category_rooms (å…³è”è¡¨ - å…³ç³»å±‚)
CREATE TABLE topic_category_rooms (
    -- æ ¸å¿ƒæ ‡è¯† (åœ¨åº”ç”¨å±‚é€šè¿‡ uuid.uuid4() ç”Ÿæˆ)
    id UUID PRIMARY KEY,
    
    category_id UUID NOT NULL REFERENCES topic_categories(id) ON DELETE CASCADE,
    room_id UUID NOT NULL REFERENCES live_rooms(id) ON DELETE CASCADE,
    sort_order INT DEFAULT 0,
    
    -- æ—¶é—´æˆ³å­—æ®µï¼šä½¿ç”¨æ•°æ®åº“çº§é»˜è®¤å€¼ï¼ˆå¯¹åº” SQLAlchemy çš„ server_default=func.now()ï¼‰
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- ç¡®ä¿åŒä¸€ä¸ªç›´æ’­é—´åœ¨ä¸€ä¸ªåˆ†ç±»ä¸‹åªå…³è”ä¸€æ¬¡
    UNIQUE (category_id, room_id)
);

-- ç´¢å¼•
CREATE INDEX idx_tcr_on_category_id ON topic_category_rooms(category_id);
CREATE INDEX idx_tcr_on_room_id ON topic_category_rooms(room_id);
CREATE INDEX idx_tcr_on_category_sort ON topic_category_rooms(category_id, sort_order);

COMMENT ON TABLE topic_category_rooms IS 'ä¸“é¢˜åˆ†ç±»ä¸ç›´æ’­é—´çš„"å¤šå¯¹å¤š"å…³è”è¡¨ï¼Œç”¨äºå®šä¹‰èšåˆé¡µé¢çš„å†…å®¹ç»“æ„ã€‚';
COMMENT ON COLUMN topic_category_rooms.sort_order IS 'ç›´æ’­é—´åœ¨è¯¥åˆ†ç±»ä¸‹çš„æ˜¾ç¤ºé¡ºåºï¼Œæ•°å€¼è¶Šå°è¶Šé å‰';
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šAPI æ¥å£è§„èŒƒ

### 8.X. èµ„æº: ä¸“é¢˜ä¸å†…å®¹ç»„ç»‡ (`topics`) (æ–°å¢)

æœ¬æ¨¡å—è´Ÿè´£ä¸“é¢˜æ´»åŠ¨çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬ä¸“é¢˜çš„åˆ›å»ºä¸ç»´æŠ¤ã€ä¸“é¢˜å†…åˆ†ç±»çš„ç»„ç»‡ï¼Œä»¥åŠç›´æ’­é—´ä¸åˆ†ç±»çš„å…³è”ç®¡ç†ã€‚

**è®¤è¯è¦æ±‚**: æ‰€æœ‰ä»¥ä¸‹APIæ¥å£éƒ½éœ€è¦JWT Tokenè®¤è¯ï¼Œè¯·æ±‚å¤´å¿…é¡»åŒ…å« `Authorization: Bearer <JWT_TOKEN>`ã€‚

---

### 8.X.1. æƒé™æ§åˆ¶è§„åˆ™

#### **ä¸“é¢˜ç®¡ç†æƒé™**
- **åˆ›å»ºä¸“é¢˜**: æ‰€æœ‰ç™»å½•ç”¨æˆ·å‡å¯åˆ›å»º
- **æŸ¥çœ‹ä¸“é¢˜åˆ—è¡¨**: æ‰€æœ‰ç™»å½•ç”¨æˆ·å‡å¯æŸ¥çœ‹æ‰€æœ‰å·²å‘å¸ƒ(published)çš„ä¸“é¢˜
- **æŸ¥çœ‹ä¸“é¢˜è¯¦æƒ…**: æ‰€æœ‰ç™»å½•ç”¨æˆ·å‡å¯æŸ¥çœ‹å·²å‘å¸ƒ(published)çš„ä¸“é¢˜è¯¦æƒ…
- **ä¿®æ”¹ä¸“é¢˜**: ä»…åˆ›å»ºè€…æœ¬äººå¯æ“ä½œï¼ˆuser_idåŒ¹é…ï¼‰
- **åˆ é™¤ä¸“é¢˜**: ä»…åˆ›å»ºè€…æœ¬äººå¯æ“ä½œï¼ˆuser_idåŒ¹é…ï¼‰

#### **åˆ†ç±»ç®¡ç†æƒé™**
- **åˆ›å»ºåˆ†ç±»**: ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œï¼ˆé€šè¿‡topic_idå…³è”éªŒè¯user_idï¼‰
- **ä¿®æ”¹åˆ†ç±»**: ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œï¼ˆé€šè¿‡topic_idå…³è”éªŒè¯user_idï¼‰
- **åˆ é™¤åˆ†ç±»**: ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œï¼ˆé€šè¿‡topic_idå…³è”éªŒè¯user_idï¼‰
- **æŸ¥çœ‹åˆ†ç±»åˆ—è¡¨**: æ‰€æœ‰ç™»å½•ç”¨æˆ·å‡å¯æŸ¥çœ‹å·²å‘å¸ƒä¸“é¢˜çš„åˆ†ç±»

#### **ç›´æ’­é—´å…³è”æƒé™**
- **æ·»åŠ ç›´æ’­é—´åˆ°åˆ†ç±»**: ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œï¼ˆé€šè¿‡topic_idå…³è”éªŒè¯user_idï¼‰
- **ç§»é™¤ç›´æ’­é—´**: ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œï¼ˆé€šè¿‡topic_idå…³è”éªŒè¯user_idï¼‰
- **æ›´æ–°æ’åº**: ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œï¼ˆé€šè¿‡topic_idå…³è”éªŒè¯user_idï¼‰
- **æŸ¥çœ‹åˆ†ç±»ä¸‹çš„ç›´æ’­é—´**: æ‰€æœ‰ç™»å½•ç”¨æˆ·å‡å¯æŸ¥çœ‹å·²å‘å¸ƒä¸“é¢˜çš„ç›´æ’­é—´åˆ—è¡¨

---

### 8.X.2. ä¸“é¢˜ (`Topics`)

#### **1. åˆ›å»ºä¸“é¢˜ (Create)**

* **Endpoint**: `POST /api/v1/topics`
* **åŠŸèƒ½æè¿°**: åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸“é¢˜æ´»åŠ¨ï¼Œä½œä¸ºå†…å®¹èšåˆçš„é¡¶å±‚å®¹å™¨ã€‚
* **è¯·æ±‚ä½“** (`application/json`):
  ```json
  {
    "title": "ä¾ è€…ä»å¿ƒÂ·çºµæ¨ªè®ºé“",
    "description": "2025å¹´åº¦ç³»åˆ—æ‰‹æœ¯æŠ€æœ¯ç›´æ’­åˆ†äº«æ´»åŠ¨ã€‚",
    "banner_url": "/media/topics/temp_banner.jpg",
    "status": "published"
  }
  ```
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": "topic_uuid_1",
      "user_id": "user_uuid_123",
      "title": "ä¾ è€…ä»å¿ƒÂ·çºµæ¨ªè®ºé“",
      "description": "2025å¹´åº¦ç³»åˆ—æ‰‹æœ¯æŠ€æœ¯ç›´æ’­åˆ†äº«æ´»åŠ¨ã€‚",
      "banner_url": "/media/topics/temp_banner.jpg",
      "status": "published",
      "created_at": "2025-10-15T10:00:00Z",
      "updated_at": "2025-10-15T10:00:00Z"
    },
    "timestamp": "2025-10-15T10:00:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`400 Bad Request` - å‚æ•°æ ¡éªŒå¤±è´¥):
  ```json
  {
    "code": 4001,
    "message": "å‚æ•°æ ¡éªŒå¤±è´¥",
    "data": {
      "field": "title",
      "error": "æ ‡é¢˜ä¸èƒ½ä¸ºç©º"
    },
    "timestamp": "2025-10-15T10:00:05Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ Pydantic æ¨¡å‹ `TopicCreate` å’Œä¾èµ–æ³¨å…¥çš„ `current_user`ã€æ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ä¾èµ–æ³¨å…¥ `Depends(get_current_user)` éªŒè¯Tokenå¹¶æå– `user_id`ã€‚
  3. **æ•°æ®éªŒè¯**: Pydanticæ¨¡å‹è‡ªåŠ¨éªŒè¯è¯·æ±‚ä½“æ ¼å¼ï¼Œæ£€æŸ¥å¿…å¡«å­—æ®µï¼ˆtitleï¼‰å’Œæšä¸¾å€¼ï¼ˆstatusï¼‰çš„æœ‰æ•ˆæ€§ã€‚
  4. **ç”ŸæˆUUID**: åœ¨åº”ç”¨å±‚é€šè¿‡ `uuid.uuid4()` ç”Ÿæˆä¸“é¢˜çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
  5. **åˆ›å»ºæ•°æ®åº“å¯¹è±¡**: åˆ›å»º `models.Topic` å®ä¾‹ï¼Œå¡«å……æ‰€æœ‰å­—æ®µï¼ŒåŒ…æ‹¬ä»Tokenä¸­æå–çš„ `user_id`ã€‚
  6. **æŒä¹…åŒ–**: é€šè¿‡ `db.add()`, `await db.commit()`, `await db.refresh()` å°†æ–°ä¸“é¢˜ä¿å­˜åˆ°æ•°æ®åº“ã€‚
  7. **æ—¥å¿—è®°å½•**: è®°å½•INFOçº§åˆ«æ—¥å¿—ï¼ŒåŒ…å« `user_id`, `topic_id`, `action: create_topic`ã€‚
  8. **æ„å»ºå“åº”**: æ„å»ºç¬¦åˆé€šç”¨å“åº”ç»“æ„çš„æˆåŠŸå“åº”å¹¶è¿”å›ã€‚

---

#### **2. è·å–ä¸“é¢˜åˆ—è¡¨ (Read - List)**

* **Endpoint**: `GET /api/v1/topics`
* **åŠŸèƒ½æè¿°**: åˆ†é¡µè·å–ä¸“é¢˜åˆ—è¡¨ã€‚æ”¯æŒæŒ‰çŠ¶æ€ã€ç”¨æˆ·IDç­›é€‰ã€‚
* **è¯·æ±‚å‚æ•° (Query)**:
  - `page`: é¡µç ï¼Œé»˜è®¤1
  - `size`: æ¯é¡µæ¡æ•°ï¼Œé»˜è®¤10ï¼Œæœ€å¤§100
  - `sort`: æ’åºè§„åˆ™ï¼Œé»˜è®¤ `created_at:desc`
  - `status`: çŠ¶æ€ç­›é€‰ï¼Œå¯é€‰å€¼: `draft`, `published`, `archived`ï¼ˆå¯é€‰ï¼‰
  - `user_id`: ç”¨æˆ·IDç­›é€‰ï¼Œä»…è¿”å›æŒ‡å®šç”¨æˆ·åˆ›å»ºçš„ä¸“é¢˜ï¼ˆå¯é€‰ï¼‰
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "total": 5,
      "page": 1,
      "size": 10,
      "items": [
        {
          "id": "topic_uuid_1",
          "title": "ä¾ è€…ä»å¿ƒÂ·çºµæ¨ªè®ºé“",
          "status": "published",
          "banner_url": "/media/topics/banner_main.jpg",
          "created_at": "2025-10-15T10:00:00Z"
        }
      ]
    },
    "timestamp": "2025-10-15T10:02:00Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ³¨å…¥åˆ†é¡µå‚æ•°å¯¹è±¡ `PaginationParams` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½ã€‚
  3. **æ„å»ºæŸ¥è¯¢**: æ„å»ºåŸºç¡€çš„ `select(models.Topic)` æŸ¥è¯¢ã€‚
  4. **åº”ç”¨ç­›é€‰æ¡ä»¶**:
     - å¦‚æœæä¾›äº† `status` å‚æ•°ï¼Œæ·»åŠ  `where(Topic.status == status)` æ¡ä»¶ã€‚
     - å¦‚æœæä¾›äº† `user_id` å‚æ•°ï¼Œæ·»åŠ  `where(Topic.user_id == user_id)` æ¡ä»¶ã€‚
  5. **æ‰§è¡Œè®¡æ•°æŸ¥è¯¢**: æ‰§è¡Œ `count()` æŸ¥è¯¢è·å–ç¬¦åˆæ¡ä»¶çš„æ€»è®°å½•æ•°ã€‚
  6. **åº”ç”¨æ’åºå’Œåˆ†é¡µ**: åº”ç”¨ `order_by`, `offset`, `limit` åˆ°æŸ¥è¯¢ä¸Šã€‚
  7. **æ‰§è¡ŒæŸ¥è¯¢**: è·å–å½“å‰é¡µçš„ `items`ã€‚
  8. **æ—¥å¿—è®°å½•**: è®°å½•DEBUGçº§åˆ«æ—¥å¿—ï¼ŒåŒ…å«æŸ¥è¯¢æ¡ä»¶å’Œè¿”å›ç»“æœæ•°é‡ã€‚
  9. **æ„å»ºå“åº”**: æ„å»ºç¬¦åˆåˆ†é¡µå“åº”æ ¼å¼çš„æˆåŠŸå“åº”å¹¶è¿”å›ã€‚

---

#### **3. è·å–ä¸“é¢˜èšåˆé¡µè¯¦æƒ… (Read - Single)**

* **Endpoint**: `GET /api/v1/topics/{topic_id}`
* **åŠŸèƒ½æè¿°**: è·å–æŒ‡å®šä¸“é¢˜çš„å®Œæ•´ã€å±‚çº§åŒ–çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå‰ç«¯æ¸²æŸ“èšåˆé¡µé¢ã€‚
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": "topic_uuid_1",
      "title": "ä¾ è€…ä»å¿ƒÂ·çºµæ¨ªè®ºé“",
      "description": "2025å¹´åº¦ç³»åˆ—æ‰‹æœ¯æŠ€æœ¯ç›´æ’­åˆ†äº«æ´»åŠ¨ã€‚",
      "banner_url": "/media/topics/banner_main.jpg",
      "status": "published",
      "categories": [
        {
          "id": "category_uuid_yunnan",
          "name": "äº‘å—çœ",
          "sort_order": 1,
          "rooms": [
            {
              "id": "room_uuid_001",
              "title": "æ®µæ—ç¿å‰¯é™¢é•¿åŠå¿ƒèƒ¸å¤–ç§‘ä¸“å®¶å›¢é˜Ÿ...",
              "cover_url": "/media/rooms/.../cover_1.jpg",
              "live_status": "finished",
              "start_time": "2025-09-18T08:30:00Z",
              "heat": 14200
            }
          ]
        }
      ],
      "created_at": "2025-10-15T10:00:00Z",
      "updated_at": "2025-10-15T10:00:00Z"
    },
    "timestamp": "2025-10-15T10:05:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`404 Not Found`):
  ```json
  {
    "code": 2001,
    "message": "èµ„æºä¸å­˜åœ¨",
    "data": {"resource": "Topic", "id": "non_existent_uuid"},
    "timestamp": "2025-10-15T10:06:00Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶è·¯å¾„å‚æ•° `topic_id: UUID` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½ã€‚
  3. **æŸ¥è¯¢ä¸“é¢˜åŸºæœ¬ä¿¡æ¯**: æ ¹æ® `topic_id` æŸ¥è¯¢ `topics` è¡¨ï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› HTTP `404`ã€‚
  4. **æŸ¥è¯¢åˆ†ç±»åˆ—è¡¨**: æŸ¥è¯¢ `topic_categories` è¡¨ï¼Œè·å–è¯¥ä¸“é¢˜ä¸‹çš„æ‰€æœ‰åˆ†ç±»ï¼ŒæŒ‰ `sort_order` æ’åºã€‚
  5. **å¯¹æ¯ä¸ªåˆ†ç±»ï¼ŒæŸ¥è¯¢å…³è”çš„ç›´æ’­é—´**:
     - é€šè¿‡ `topic_category_rooms` å…³è”è¡¨è·å–ç›´æ’­é—´IDåˆ—è¡¨ï¼ˆæŒ‰ `sort_order` æ’åºï¼‰ã€‚
     - æŸ¥è¯¢ `live_rooms` è¡¨è·å–ç›´æ’­é—´åŸºæœ¬ä¿¡æ¯ï¼ˆ`title`, `cover_url`ï¼‰ã€‚
     - æŸ¥è¯¢ `live_sessions` è¡¨è·å–æ¯ä¸ªç›´æ’­é—´çš„æœ€æ–°åœºæ¬¡çŠ¶æ€ï¼ˆ`live_status`, `start_time`ï¼‰ã€‚
     - **è®¡ç®—heatå€¼**: æŸ¥è¯¢ `session_statistics` è¡¨ï¼Œèšåˆè¯¥ç›´æ’­é—´æ‰€æœ‰åœºæ¬¡çš„ç»Ÿè®¡æ•°æ®ï¼š
       ```python
       heat = int(
           total_viewer_count * 0.5 + 
           total_like_count * 0.3 + 
           peak_viewer_count * 0.2
       )
       ```
  6. **æ„å»ºå±‚çº§åŒ–æ•°æ®ç»“æ„**: ç»„è£… `categories` -> `rooms` çš„åµŒå¥—ç»“æ„ã€‚
  7. **æ—¥å¿—è®°å½•**: è®°å½•INFOçº§åˆ«æ—¥å¿—ï¼ŒåŒ…å« `topic_id`, `categories_count`, `total_rooms_count`ã€‚
  8. **æ„å»ºå“åº”**: è¿”å›å®Œæ•´çš„å±‚çº§åŒ–æ•°æ®ç»“æ„ã€‚

---

#### **4. æ›´æ–°ä¸“é¢˜ä¿¡æ¯ (Update)**

* **Endpoint**: `PATCH /api/v1/topics/{topic_id}`
* **åŠŸèƒ½æè¿°**: æ›´æ–°æŒ‡å®šä¸“é¢˜çš„ä¿¡æ¯ï¼Œå¦‚æ ‡é¢˜ã€æè¿°ã€çŠ¶æ€ç­‰ã€‚ä»…åˆ›å»ºè€…æœ¬äººå¯æ“ä½œã€‚
* **è¯·æ±‚ä½“** (`application/json`):
  ```json
  {
    "title": "ä¾ è€…ä»å¿ƒÂ·çºµæ¨ªè®ºé“ (2025å¹´åº¦)",
    "status": "archived"
  }
  ```
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": "topic_uuid_1",
      "user_id": "user_uuid_123",
      "title": "ä¾ è€…ä»å¿ƒÂ·çºµæ¨ªè®ºé“ (2025å¹´åº¦)",
      "description": "2025å¹´åº¦ç³»åˆ—æ‰‹æœ¯æŠ€æœ¯ç›´æ’­åˆ†äº«æ´»åŠ¨ã€‚",
      "banner_url": "/media/topics/banner_main.jpg",
      "status": "archived",
      "created_at": "2025-10-15T10:00:00Z",
      "updated_at": "2025-10-15T10:08:00Z"
    },
    "timestamp": "2025-10-15T10:08:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`403 Forbidden` - æƒé™ä¸è¶³):
  ```json
  {
    "code": 2003,
    "message": "æ“ä½œè¢«ç¦æ­¢",
    "data": {
      "error": "æ‚¨æ²¡æœ‰æƒé™ä¿®æ”¹æ­¤ä¸“é¢˜",
      "reason": "ä»…åˆ›å»ºè€…æœ¬äººå¯ä¿®æ”¹ä¸“é¢˜"
    },
    "timestamp": "2025-10-15T10:08:05Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ `topic_id: UUID`ã€Pydantic æ¨¡å‹ `TopicUpdate`ã€`current_user` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½å¹¶æå– `user_id`ã€‚
  3. **æŸ¥è¯¢ä¸“é¢˜**: æ ¹æ® `topic_id` æŸ¥è¯¢ `topics` è¡¨ï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› HTTP `404`ã€‚
  4. **æƒé™éªŒè¯**: æ£€æŸ¥ `topic.user_id` æ˜¯å¦ç­‰äº `current_user.user_id`ï¼Œå¦‚æœä¸åŒ¹é…åˆ™è¿”å› HTTP `403`ã€‚
  5. **æ•°æ®éªŒè¯**: Pydanticæ¨¡å‹éªŒè¯æ›´æ–°æ•°æ®çš„æœ‰æ•ˆæ€§ï¼ˆå¦‚statusçš„æšä¸¾å€¼ï¼‰ã€‚
  6. **æ›´æ–°å­—æ®µ**: éå† `TopicUpdate` æ¨¡å‹ä¸­çš„éç©ºå­—æ®µï¼Œæ›´æ–° `topic` å¯¹è±¡çš„ç›¸åº”å±æ€§ã€‚
  7. **æ›´æ–°æ—¶é—´æˆ³**: è®¾ç½® `topic.updated_at = datetime.utcnow()`ã€‚
  8. **æäº¤äº‹åŠ¡**: è°ƒç”¨ `await db.commit()` å’Œ `await db.refresh(topic)`ã€‚
  9. **æ—¥å¿—è®°å½•**: è®°å½•INFOçº§åˆ«æ—¥å¿—ï¼ŒåŒ…å« `user_id`, `topic_id`, `action: update_topic`, `updated_fields`ã€‚
  10. **æ„å»ºå“åº”**: è¿”å›æ›´æ–°åçš„å®Œæ•´ä¸“é¢˜ä¿¡æ¯ã€‚

---

#### **5. åˆ é™¤ä¸“é¢˜ (Delete)**

* **Endpoint**: `DELETE /api/v1/topics/{topic_id}`
* **åŠŸèƒ½æè¿°**: åˆ é™¤ä¸€ä¸ªä¸“é¢˜ã€‚æ•°æ®åº“çš„ `ON DELETE CASCADE` è®¾ç½®å°†è‡ªåŠ¨åˆ é™¤å…¶ä¸‹æ‰€æœ‰å…³è”çš„åˆ†ç±»åŠç›´æ’­é—´å…³è”è®°å½•ã€‚ä»…åˆ›å»ºè€…æœ¬äººå¯æ“ä½œã€‚
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": "topic_uuid_1",
      "status": "deleted"
    },
    "timestamp": "2025-10-15T10:09:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`403 Forbidden` - æƒé™ä¸è¶³):
  ```json
  {
    "code": 2003,
    "message": "æ“ä½œè¢«ç¦æ­¢",
    "data": {
      "error": "æ‚¨æ²¡æœ‰æƒé™åˆ é™¤æ­¤ä¸“é¢˜",
      "reason": "ä»…åˆ›å»ºè€…æœ¬äººå¯åˆ é™¤ä¸“é¢˜"
    },
    "timestamp": "2025-10-15T10:09:05Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ `topic_id: UUID`ã€`current_user` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½å¹¶æå– `user_id`ã€‚
  3. **æŸ¥è¯¢ä¸“é¢˜**: æ ¹æ® `topic_id` æŸ¥è¯¢ `topics` è¡¨ï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› HTTP `404`ã€‚
  4. **æƒé™éªŒè¯**: æ£€æŸ¥ `topic.user_id` æ˜¯å¦ç­‰äº `current_user.user_id`ï¼Œå¦‚æœä¸åŒ¹é…åˆ™è¿”å› HTTP `403`ã€‚
  5. **æ•°æ®åº“æ“ä½œ**: è°ƒç”¨ `await db.delete(topic)` æ ‡è®°ä¸ºå¾…åˆ é™¤ã€‚
  6. **æäº¤äº‹åŠ¡**: è°ƒç”¨ `await db.commit()`ã€‚çº§è”åˆ é™¤ä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰å…³è”çš„ `topic_categories` å’Œ `topic_category_rooms` è®°å½•ã€‚
  7. **æ—¥å¿—è®°å½•**: è®°å½•WARNINGçº§åˆ«æ—¥å¿—ï¼ŒåŒ…å« `user_id`, `topic_id`, `action: delete_topic`ã€‚
  8. **æ„å»ºå“åº”**: è¿”å›æ“ä½œæˆåŠŸçš„ç®€å•å“åº”ã€‚

---

### 8.X.3. ä¸“é¢˜å†…åˆ†ç±» (`Topic Categories`)

#### **1. åˆ›å»ºä¸“é¢˜å†…åˆ†ç±» (Create)**

* **Endpoint**: `POST /api/v1/topics/{topic_id}/categories`
* **åŠŸèƒ½æè¿°**: åœ¨æŒ‡å®šçš„ä¸“é¢˜ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†ç±»ã€‚ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œã€‚
* **è¯·æ±‚ä½“** (`application/json`):
  ```json
  {
    "name": "æ¹–å—çœ",
    "sort_order": 2
  }
  ```
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": "category_uuid_hunan",
      "topic_id": "topic_uuid_1",
      "name": "æ¹–å—çœ",
      "sort_order": 2,
      "created_at": "2025-10-15T10:10:00Z",
      "updated_at": "2025-10-15T10:10:00Z"
    },
    "timestamp": "2025-10-15T10:10:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`404 Not Found` - ä¸“é¢˜ä¸å­˜åœ¨):
  ```json
  {
    "code": 2001,
    "message": "èµ„æºä¸å­˜åœ¨",
    "data": {"resource": "Topic", "id": "non_existent_uuid"},
    "timestamp": "2025-10-15T10:11:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`403 Forbidden` - æƒé™ä¸è¶³):
  ```json
  {
    "code": 2003,
    "message": "æ“ä½œè¢«ç¦æ­¢",
    "data": {
      "error": "æ‚¨æ²¡æœ‰æƒé™åœ¨æ­¤ä¸“é¢˜ä¸‹åˆ›å»ºåˆ†ç±»",
      "reason": "ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œ"
    },
    "timestamp": "2025-10-15T10:11:05Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ `topic_id: UUID`ã€Pydantic æ¨¡å‹ `CategoryCreate`ã€`current_user` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½å¹¶æå– `user_id`ã€‚
  3. **æŸ¥è¯¢å¹¶éªŒè¯ä¸“é¢˜**: æ ¹æ® `topic_id` æŸ¥è¯¢ `topics` è¡¨ï¼Œå¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› HTTP `404`ã€‚
  4. **æƒé™éªŒè¯**: æ£€æŸ¥ `topic.user_id` æ˜¯å¦ç­‰äº `current_user.user_id`ï¼Œå¦‚æœä¸åŒ¹é…åˆ™è¿”å› HTTP `403`ã€‚
  5. **ç”ŸæˆUUID**: åœ¨åº”ç”¨å±‚é€šè¿‡ `uuid.uuid4()` ç”Ÿæˆåˆ†ç±»çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
  6. **åˆ›å»ºæ•°æ®åº“å¯¹è±¡**: åˆ›å»º `models.TopicCategory` å®ä¾‹ï¼Œå¡«å……æ‰€æœ‰å­—æ®µã€‚
  7. **æŒä¹…åŒ–**: é€šè¿‡ `db.add()`, `await db.commit()`, `await db.refresh()` ä¿å­˜åˆ°æ•°æ®åº“ã€‚
  8. **æ—¥å¿—è®°å½•**: è®°å½•INFOçº§åˆ«æ—¥å¿—ï¼ŒåŒ…å« `user_id`, `topic_id`, `category_id`, `action: create_category`ã€‚
  9. **æ„å»ºå“åº”**: è¿”å›æ–°åˆ›å»ºçš„åˆ†ç±»ä¿¡æ¯ã€‚

---

#### **2. è·å–ä¸“é¢˜çš„åˆ†ç±»åˆ—è¡¨ (Read - List)**

* **Endpoint**: `GET /api/v1/topics/{topic_id}/categories`
* **åŠŸèƒ½æè¿°**: åˆ†é¡µè·å–æŒ‡å®šä¸“é¢˜ä¸‹çš„æ‰€æœ‰åˆ†ç±»åˆ—è¡¨ã€‚
* **è¯·æ±‚å‚æ•° (Query)**: `page`, `size`, `sort`
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "total": 5,
      "page": 1,
      "size": 10,
      "items": [
        {
          "id": "category_uuid_yunnan",
          "topic_id": "topic_uuid_1",
          "name": "äº‘å—çœ",
          "sort_order": 1,
          "created_at": "2025-10-15T09:00:00Z",
          "updated_at": "2025-10-15T09:00:00Z"
        },
        {
          "id": "category_uuid_hunan",
          "topic_id": "topic_uuid_1",
          "name": "æ¹–å—çœ",
          "sort_order": 2,
          "created_at": "2025-10-15T10:10:00Z",
          "updated_at": "2025-10-15T10:10:00Z"
        }
      ]
    },
    "timestamp": "2025-10-15T10:12:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`404 Not Found` - ä¸“é¢˜ä¸å­˜åœ¨):
  ```json
  {
    "code": 2001,
    "message": "èµ„æºä¸å­˜åœ¨",
    "data": {"resource": "Topic", "id": "non_existent_uuid"},
    "timestamp": "2025-10-15T10:12:05Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ `topic_id: UUID`ã€åˆ†é¡µå‚æ•° `PaginationParams` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½ã€‚
  3. **éªŒè¯ä¸“é¢˜å­˜åœ¨æ€§**: æŸ¥è¯¢ `topics` è¡¨ç¡®è®¤ä¸“é¢˜å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› HTTP `404`ã€‚
  4. **æ„å»ºæŸ¥è¯¢**: æ„å»º `select(models.TopicCategory).where(TopicCategory.topic_id == topic_id)` æŸ¥è¯¢ã€‚
  5. **æ‰§è¡Œè®¡æ•°æŸ¥è¯¢**: è·å–è¯¥ä¸“é¢˜ä¸‹åˆ†ç±»çš„æ€»æ•°ã€‚
  6. **åº”ç”¨æ’åºå’Œåˆ†é¡µ**: é»˜è®¤æŒ‰ `sort_order` ASC æ’åºï¼Œåº”ç”¨ `offset` å’Œ `limit`ã€‚
  7. **æ‰§è¡ŒæŸ¥è¯¢**: è·å–å½“å‰é¡µçš„åˆ†ç±»åˆ—è¡¨ã€‚
  8. **æ—¥å¿—è®°å½•**: è®°å½•DEBUGçº§åˆ«æ—¥å¿—ã€‚
  9. **æ„å»ºå“åº”**: æ„å»ºç¬¦åˆåˆ†é¡µå“åº”æ ¼å¼çš„æˆåŠŸå“åº”ã€‚

---

#### **3. æ›´æ–°ä¸“é¢˜å†…åˆ†ç±» (Update)**

* **Endpoint**: `PATCH /api/v1/topic-categories/{category_id}`
* **åŠŸèƒ½æè¿°**: æ›´æ–°æŒ‡å®šåˆ†ç±»çš„åç§°æˆ–æ’åºã€‚ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œã€‚
* **è¯·æ±‚ä½“** (`application/json`):
  ```json
  {
    "name": "æ¹–å—çœä¸“å®¶åœº",
    "sort_order": 3
  }
  ```
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": "category_uuid_hunan",
      "topic_id": "topic_uuid_1",
      "name": "æ¹–å—çœä¸“å®¶åœº",
      "sort_order": 3,
      "created_at": "2025-10-15T10:10:00Z",
      "updated_at": "2025-10-15T10:13:00Z"
    },
    "timestamp": "2025-10-15T10:13:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`403 Forbidden` - æƒé™ä¸è¶³):
  ```json
  {
    "code": 2003,
    "message": "æ“ä½œè¢«ç¦æ­¢",
    "data": {
      "error": "æ‚¨æ²¡æœ‰æƒé™ä¿®æ”¹æ­¤åˆ†ç±»",
      "reason": "ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œ"
    },
    "timestamp": "2025-10-15T10:13:05Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ `category_id: UUID`ã€Pydantic æ¨¡å‹ `CategoryUpdate`ã€`current_user` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½å¹¶æå– `user_id`ã€‚
  3. **æŸ¥è¯¢åˆ†ç±»**: æ ¹æ® `category_id` æŸ¥è¯¢ `topic_categories` è¡¨ï¼ŒJOIN `topics` è¡¨ä»¥è·å– `topic.user_id`ã€‚å¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› HTTP `404`ã€‚
  4. **æƒé™éªŒè¯**: æ£€æŸ¥ `topic.user_id` æ˜¯å¦ç­‰äº `current_user.user_id`ï¼Œå¦‚æœä¸åŒ¹é…åˆ™è¿”å› HTTP `403`ã€‚
  5. **æ›´æ–°å­—æ®µ**: éå† `CategoryUpdate` æ¨¡å‹ä¸­çš„éç©ºå­—æ®µï¼Œæ›´æ–° `category` å¯¹è±¡çš„ç›¸åº”å±æ€§ã€‚
  6. **æ›´æ–°æ—¶é—´æˆ³**: è®¾ç½® `category.updated_at = datetime.utcnow()`ã€‚
  7. **æäº¤äº‹åŠ¡**: è°ƒç”¨ `await db.commit()` å’Œ `await db.refresh(category)`ã€‚
  8. **æ—¥å¿—è®°å½•**: è®°å½•INFOçº§åˆ«æ—¥å¿—ã€‚
  9. **æ„å»ºå“åº”**: è¿”å›æ›´æ–°åçš„åˆ†ç±»ä¿¡æ¯ã€‚

---

#### **4. åˆ é™¤ä¸“é¢˜å†…åˆ†ç±» (Delete)**

* **Endpoint**: `DELETE /api/v1/topic-categories/{category_id}`
* **åŠŸèƒ½æè¿°**: åˆ é™¤ä¸€ä¸ªä¸“é¢˜åˆ†ç±»ï¼Œå…¶ä¸‹æ‰€æœ‰ç›´æ’­é—´å…³è”è®°å½•ä¹Ÿå°†è¢«çº§è”åˆ é™¤ã€‚ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œã€‚
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": "category_uuid_hunan",
      "status": "deleted"
    },
    "timestamp": "2025-10-15T10:14:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`403 Forbidden` - æƒé™ä¸è¶³):
  ```json
  {
    "code": 2003,
    "message": "æ“ä½œè¢«ç¦æ­¢",
    "data": {
      "error": "æ‚¨æ²¡æœ‰æƒé™åˆ é™¤æ­¤åˆ†ç±»",
      "reason": "ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œ"
    },
    "timestamp": "2025-10-15T10:14:05Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ `category_id: UUID`ã€`current_user` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½å¹¶æå– `user_id`ã€‚
  3. **æŸ¥è¯¢åˆ†ç±»**: æ ¹æ® `category_id` æŸ¥è¯¢ `topic_categories` è¡¨ï¼ŒJOIN `topics` è¡¨ä»¥è·å– `topic.user_id`ã€‚å¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› HTTP `404`ã€‚
  4. **æƒé™éªŒè¯**: æ£€æŸ¥ `topic.user_id` æ˜¯å¦ç­‰äº `current_user.user_id`ï¼Œå¦‚æœä¸åŒ¹é…åˆ™è¿”å› HTTP `403`ã€‚
  5. **æ•°æ®åº“æ“ä½œ**: è°ƒç”¨ `await db.delete(category)` æ ‡è®°ä¸ºå¾…åˆ é™¤ã€‚
  6. **æäº¤äº‹åŠ¡**: è°ƒç”¨ `await db.commit()`ã€‚çº§è”åˆ é™¤ä¼šè‡ªåŠ¨å¤„ç†æ‰€æœ‰å…³è”çš„ `topic_category_rooms` è®°å½•ã€‚
  7. **æ—¥å¿—è®°å½•**: è®°å½•WARNINGçº§åˆ«æ—¥å¿—ã€‚
  8. **æ„å»ºå“åº”**: è¿”å›æ“ä½œæˆåŠŸçš„ç®€å•å“åº”ã€‚

---

### 8.X.4. åˆ†ç±»ä¸ç›´æ’­é—´çš„å…³è”ç®¡ç†

#### **1. å°†ç›´æ’­é—´å…³è”åˆ°åˆ†ç±» (Create Association)**

* **Endpoint**: `POST /api/v1/topic-categories/{category_id}/rooms`
* **åŠŸèƒ½æè¿°**: å°†ä¸€ä¸ªæˆ–å¤šä¸ªå·²å­˜åœ¨çš„ç›´æ’­é—´æ·»åŠ åˆ°æŒ‡å®šçš„ä¸“é¢˜åˆ†ç±»ä¸‹ã€‚ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œã€‚
* **è¯·æ±‚ä½“** (`application/json`):
  ```json
  {
    "rooms": [
      { "room_id": "room_uuid_002", "sort_order": 1 },
      { "room_id": "room_uuid_003", "sort_order": 2 }
    ]
  }
  ```
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "category_id": "category_uuid_hunan",
      "associated_rooms_count": 2,
      "associated_rooms": [
        {
          "id": "tcr_uuid_1",
          "room_id": "room_uuid_002",
          "sort_order": 1
        },
        {
          "id": "tcr_uuid_2",
          "room_id": "room_uuid_003",
          "sort_order": 2
        }
      ]
    },
    "timestamp": "2025-10-15T10:15:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`400 Bad Request` - ç›´æ’­é—´ä¸å­˜åœ¨):
  ```json
  {
    "code": 4001,
    "message": "å‚æ•°æ ¡éªŒå¤±è´¥",
    "data": {
      "field": "room_id",
      "error": "ç›´æ’­é—´ä¸å­˜åœ¨",
      "invalid_room_ids": ["room_uuid_999"]
    },
    "timestamp": "2025-10-15T10:15:05Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`403 Forbidden` - æƒé™ä¸è¶³):
  ```json
  {
    "code": 2003,
    "message": "æ“ä½œè¢«ç¦æ­¢",
    "data": {
      "error": "æ‚¨æ²¡æœ‰æƒé™åœ¨æ­¤åˆ†ç±»ä¸‹æ·»åŠ ç›´æ’­é—´",
      "reason": "ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œ"
    },
    "timestamp": "2025-10-15T10:15:06Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ `category_id: UUID`ã€Pydantic æ¨¡å‹ `AddRoomsRequest`ã€`current_user` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½å¹¶æå– `user_id`ã€‚
  3. **æŸ¥è¯¢å¹¶éªŒè¯åˆ†ç±»**: æ ¹æ® `category_id` æŸ¥è¯¢ `topic_categories` è¡¨ï¼ŒJOIN `topics` è¡¨ã€‚å¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› HTTP `404`ã€‚
  4. **æƒé™éªŒè¯**: æ£€æŸ¥ `topic.user_id` æ˜¯å¦ç­‰äº `current_user.user_id`ï¼Œå¦‚æœä¸åŒ¹é…åˆ™è¿”å› HTTP `403`ã€‚
  5. **éªŒè¯ç›´æ’­é—´å­˜åœ¨æ€§**: æ‰¹é‡æŸ¥è¯¢ `live_rooms` è¡¨ï¼Œç¡®è®¤æ‰€æœ‰ `room_id` éƒ½å­˜åœ¨ã€‚å¦‚æœæœ‰ä¸å­˜åœ¨çš„ï¼Œè¿”å› HTTP `400`ã€‚
  6. **æ£€æŸ¥é‡å¤å…³è”**: æŸ¥è¯¢ `topic_category_rooms` è¡¨ï¼Œæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨å…³è”è®°å½•ï¼ˆä½¿ç”¨UNIQUEçº¦æŸï¼‰ã€‚
  7. **æ‰¹é‡åˆ›å»ºå…³è”**: éå†è¯·æ±‚ä¸­çš„roomsåˆ—è¡¨ï¼Œä¸ºæ¯ä¸ªroomåˆ›å»º `models.TopicCategoryRoom` å®ä¾‹ã€‚
  8. **æŒä¹…åŒ–**: é€šè¿‡ `db.add_all()` å’Œ `await db.commit()` æ‰¹é‡ä¿å­˜ã€‚
  9. **æ—¥å¿—è®°å½•**: è®°å½•INFOçº§åˆ«æ—¥å¿—ã€‚
  10. **æ„å»ºå“åº”**: è¿”å›å…³è”æˆåŠŸçš„ç»Ÿè®¡ä¿¡æ¯å’Œè¯¦ç»†åˆ—è¡¨ã€‚

---

#### **2. è·å–åˆ†ç±»ä¸‹çš„ç›´æ’­é—´åˆ—è¡¨ (Read Association)**

* **Endpoint**: `GET /api/v1/topic-categories/{category_id}/rooms`
* **åŠŸèƒ½æè¿°**: åˆ†é¡µè·å–æŒ‡å®šåˆ†ç±»ä¸‹æ‰€æœ‰å…³è”çš„ç›´æ’­é—´åˆ—è¡¨ã€‚
* **è¯·æ±‚å‚æ•° (Query)**: `page`, `size`, `sort`
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "total": 2,
      "page": 1,
      "size": 10,
      "items": [
        {
          "id": "room_uuid_002",
          "title": "ç›´æ’­é—´æ ‡é¢˜äºŒ",
          "cover_url": "/media/rooms/.../cover_2.jpg",
          "sort_order": 1,
          "live_status": "scheduled",
          "created_at": "2025-10-14T10:00:00Z"
        },
        {
          "id": "room_uuid_003",
          "title": "ç›´æ’­é—´æ ‡é¢˜ä¸‰",
          "cover_url": "/media/rooms/.../cover_3.jpg",
          "sort_order": 2,
          "live_status": "finished",
          "created_at": "2025-10-13T10:00:00Z"
        }
      ]
    },
    "timestamp": "2025-10-15T10:18:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`404 Not Found` - åˆ†ç±»ä¸å­˜åœ¨):
  ```json
  {
    "code": 2001,
    "message": "èµ„æºä¸å­˜åœ¨",
    "data": {"resource": "TopicCategory", "id": "non_existent_uuid"},
    "timestamp": "2025-10-15T10:18:05Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ `category_id: UUID`ã€åˆ†é¡µå‚æ•° `PaginationParams` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½ã€‚
  3. **éªŒè¯åˆ†ç±»å­˜åœ¨æ€§**: æŸ¥è¯¢ `topic_categories` è¡¨ç¡®è®¤åˆ†ç±»å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› HTTP `404`ã€‚
  4. **æ„å»ºæŸ¥è¯¢**: æŸ¥è¯¢ `topic_category_rooms` JOIN `live_rooms`ï¼Œç­›é€‰ `category_id` åŒ¹é…çš„è®°å½•ã€‚
  5. **æ‰§è¡Œè®¡æ•°æŸ¥è¯¢**: è·å–è¯¥åˆ†ç±»ä¸‹ç›´æ’­é—´çš„æ€»æ•°ã€‚
  6. **åº”ç”¨æ’åºå’Œåˆ†é¡µ**: æŒ‰ `topic_category_rooms.sort_order` ASC æ’åºï¼Œåº”ç”¨ `offset` å’Œ `limit`ã€‚
  7. **æŸ¥è¯¢ç›´æ’­çŠ¶æ€**: å¯¹æ¯ä¸ªç›´æ’­é—´ï¼ŒLEFT JOIN `live_sessions` è¡¨è·å–æœ€æ–°çš„ `status`ï¼ˆä¼˜å…ˆè¿”å› `live` çŠ¶æ€ï¼‰ã€‚
  8. **æ‰§è¡ŒæŸ¥è¯¢**: è·å–å½“å‰é¡µçš„ç›´æ’­é—´åˆ—è¡¨ã€‚
  9. **æ—¥å¿—è®°å½•**: è®°å½•DEBUGçº§åˆ«æ—¥å¿—ã€‚
  10. **æ„å»ºå“åº”**: æ„å»ºç¬¦åˆåˆ†é¡µå“åº”æ ¼å¼çš„æˆåŠŸå“åº”ã€‚

---

#### **3. æ›´æ–°åˆ†ç±»ä¸‹ç›´æ’­é—´çš„æ’åº (Update Association)**

* **Endpoint**: `PATCH /api/v1/topic-categories/{category_id}/rooms/sort-order`
* **åŠŸèƒ½æè¿°**: æ‰¹é‡æ›´æ–°åˆ†ç±»ä¸‹ç›´æ’­é—´çš„æ’åºã€‚ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œã€‚
* **è¯·æ±‚ä½“** (`application/json`):
  ```json
  {
    "rooms": [
      { "room_id": "room_uuid_003", "sort_order": 1 },
      { "room_id": "room_uuid_002", "sort_order": 2 }
    ]
  }
  ```
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "category_id": "category_uuid_hunan",
      "reordered_rooms_count": 2
    },
    "timestamp": "2025-10-15T10:19:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`403 Forbidden` - æƒé™ä¸è¶³):
  ```json
  {
    "code": 2003,
    "message": "æ“ä½œè¢«ç¦æ­¢",
    "data": {
      "error": "æ‚¨æ²¡æœ‰æƒé™ä¿®æ”¹æ­¤åˆ†ç±»çš„ç›´æ’­é—´æ’åº",
      "reason": "ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œ"
    },
    "timestamp": "2025-10-15T10:19:05Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ `category_id: UUID`ã€Pydantic æ¨¡å‹ `UpdateRoomSortRequest`ã€`current_user` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½å¹¶æå– `user_id`ã€‚
  3. **æŸ¥è¯¢å¹¶éªŒè¯åˆ†ç±»**: æ ¹æ® `category_id` æŸ¥è¯¢ `topic_categories` è¡¨ï¼ŒJOIN `topics` è¡¨ã€‚å¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› HTTP `404`ã€‚
  4. **æƒé™éªŒè¯**: æ£€æŸ¥ `topic.user_id` æ˜¯å¦ç­‰äº `current_user.user_id`ï¼Œå¦‚æœä¸åŒ¹é…åˆ™è¿”å› HTTP `403`ã€‚
  5. **æ‰¹é‡æŸ¥è¯¢å…³è”è®°å½•**: æŸ¥è¯¢ `topic_category_rooms` è¡¨ï¼Œè·å–æ‰€æœ‰éœ€è¦æ›´æ–°çš„å…³è”è®°å½•ã€‚
  6. **æ‰¹é‡æ›´æ–°æ’åº**: éå†è¯·æ±‚ä¸­çš„roomsåˆ—è¡¨ï¼Œæ›´æ–°æ¯æ¡å…³è”è®°å½•çš„ `sort_order` å’Œ `updated_at`ã€‚
  7. **æäº¤äº‹åŠ¡**: è°ƒç”¨ `await db.commit()`ã€‚
  8. **æ—¥å¿—è®°å½•**: è®°å½•INFOçº§åˆ«æ—¥å¿—ã€‚
  9. **æ„å»ºå“åº”**: è¿”å›æ›´æ–°æˆåŠŸçš„ç»Ÿè®¡ä¿¡æ¯ã€‚

---

#### **4. ä»åˆ†ç±»ä¸­ç§»é™¤ç›´æ’­é—´ (Delete Association)**

* **Endpoint**: `DELETE /api/v1/topic-categories/{category_id}/rooms`
* **åŠŸèƒ½æè¿°**: å°†ä¸€ä¸ªæˆ–å¤šä¸ªç›´æ’­é—´ä»æŒ‡å®šçš„ä¸“é¢˜åˆ†ç±»ä¸­è§£é™¤å…³è”ã€‚ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œã€‚
* **è¯·æ±‚ä½“** (`application/json`):
  ```json
  {
    "room_ids": ["room_uuid_002"]
  }
  ```
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "category_id": "category_uuid_hunan",
      "disassociated_rooms_count": 1
    },
    "timestamp": "2025-10-15T10:20:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`403 Forbidden` - æƒé™ä¸è¶³):
  ```json
  {
    "code": 2003,
    "message": "æ“ä½œè¢«ç¦æ­¢",
    "data": {
      "error": "æ‚¨æ²¡æœ‰æƒé™ç§»é™¤æ­¤åˆ†ç±»ä¸‹çš„ç›´æ’­é—´",
      "reason": "ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œ"
    },
    "timestamp": "2025-10-15T10:20:05Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ `category_id: UUID`ã€Pydantic æ¨¡å‹ `RemoveRoomsRequest`ã€`current_user` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½å¹¶æå– `user_id`ã€‚
  3. **æŸ¥è¯¢å¹¶éªŒè¯åˆ†ç±»**: æ ¹æ® `category_id` æŸ¥è¯¢ `topic_categories` è¡¨ï¼ŒJOIN `topics` è¡¨ã€‚å¦‚æœæœªæ‰¾åˆ°åˆ™è¿”å› HTTP `404`ã€‚
  4. **æƒé™éªŒè¯**: æ£€æŸ¥ `topic.user_id` æ˜¯å¦ç­‰äº `current_user.user_id`ï¼Œå¦‚æœä¸åŒ¹é…åˆ™è¿”å› HTTP `403`ã€‚
  5. **æŸ¥è¯¢å…³è”è®°å½•**: æŸ¥è¯¢ `topic_category_rooms` è¡¨ï¼Œè·å–æ‰€æœ‰éœ€è¦åˆ é™¤çš„å…³è”è®°å½•ã€‚
  6. **æ‰¹é‡åˆ é™¤**: è°ƒç”¨ `await db.delete()` æ‰¹é‡åˆ é™¤å…³è”è®°å½•ï¼ˆä¸åˆ é™¤ç›´æ’­é—´æœ¬èº«ï¼‰ã€‚
  7. **æäº¤äº‹åŠ¡**: è°ƒç”¨ `await db.commit()`ã€‚
  8. **æ—¥å¿—è®°å½•**: è®°å½•INFOçº§åˆ«æ—¥å¿—ã€‚
  9. **æ„å»ºå“åº”**: è¿”å›åˆ é™¤æˆåŠŸçš„ç»Ÿè®¡ä¿¡æ¯ã€‚

---

### 8.X.5. è¾…åŠ©æŸ¥è¯¢æ¥å£ (æ–°å¢)

#### **1. è·å–ç›´æ’­é—´å…³è”çš„ä¸“é¢˜åˆ—è¡¨**

* **Endpoint**: `GET /api/v1/rooms/{room_id}/topics`
* **åŠŸèƒ½æè¿°**: è·å–æŒ‡å®šç›´æ’­é—´æ‰€å…³è”çš„æ‰€æœ‰ä¸“é¢˜åŠå…¶æ‰€å±åˆ†ç±»ã€‚ç”¨äºåœ¨ç›´æ’­é—´è¯¦æƒ…é¡µæ˜¾ç¤º"è¯¥ç›´æ’­é—´æ‰€å±çš„ä¸“é¢˜æ´»åŠ¨"ã€‚
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": [
      {
        "topic_id": "topic_uuid_1",
        "topic_title": "ä¾ è€…ä»å¿ƒÂ·çºµæ¨ªè®ºé“",
        "topic_status": "published",
        "category_id": "category_uuid_yunnan",
        "category_name": "äº‘å—çœ"
      },
      {
        "topic_id": "topic_uuid_2",
        "topic_title": "åŒ»ç–—åˆ›æ–°å³°ä¼š",
        "topic_status": "published",
        "category_id": "category_uuid_surgery",
        "category_name": "å¤–ç§‘ä¸“åœº"
      }
    ],
    "timestamp": "2025-10-15T11:00:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`404 Not Found` - ç›´æ’­é—´ä¸å­˜åœ¨):
  ```json
  {
    "code": 2001,
    "message": "èµ„æºä¸å­˜åœ¨",
    "data": {"resource": "Room", "id": "non_existent_uuid"},
    "timestamp": "2025-10-15T11:00:05Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ `room_id: UUID` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½ã€‚
  3. **éªŒè¯ç›´æ’­é—´å­˜åœ¨æ€§**: æŸ¥è¯¢ `live_rooms` è¡¨ç¡®è®¤ç›´æ’­é—´å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› HTTP `404`ã€‚
  4. **æ„å»ºæŸ¥è¯¢**: æŸ¥è¯¢ `topic_category_rooms` JOIN `topic_categories` JOIN `topics`ï¼Œç­›é€‰ `room_id` åŒ¹é…çš„è®°å½•ã€‚
  5. **ç­›é€‰å·²å‘å¸ƒä¸“é¢˜**: ä»…è¿”å› `status = 'published'` çš„ä¸“é¢˜ã€‚
  6. **æ‰§è¡ŒæŸ¥è¯¢**: è·å–æ‰€æœ‰å…³è”çš„ä¸“é¢˜å’Œåˆ†ç±»ä¿¡æ¯ã€‚
  7. **æ—¥å¿—è®°å½•**: è®°å½•DEBUGçº§åˆ«æ—¥å¿—ã€‚
  8. **æ„å»ºå“åº”**: è¿”å›ä¸“é¢˜åˆ—è¡¨ã€‚

---

#### **2. æ‰¹é‡è·å–ç›´æ’­é—´çŠ¶æ€**

* **Endpoint**: `POST /api/v1/rooms/batch-status`
* **åŠŸèƒ½æè¿°**: æ‰¹é‡è·å–å¤šä¸ªç›´æ’­é—´çš„å®æ—¶çŠ¶æ€ã€‚ç”¨äºå‰ç«¯æ¸²æŸ“ä¸“é¢˜é¡µæ—¶æ‰¹é‡æŸ¥è¯¢ç›´æ’­é—´çŠ¶æ€ï¼Œæé«˜æ€§èƒ½ã€‚
* **è¯·æ±‚ä½“** (`application/json`):
  ```json
  {
    "room_ids": ["room_uuid_001", "room_uuid_002", "room_uuid_003"]
  }
  ```
* **æˆåŠŸå“åº”** (`200 OK`):
  ```json
  {
    "code": 200,
    "message": "success",
    "data": [
      {
        "room_id": "room_uuid_001",
        "live_status": "live",
        "current_session_id": "session_uuid_1",
        "viewer_count": 1520
      },
      {
        "room_id": "room_uuid_002",
        "live_status": "finished",
        "current_session_id": null,
        "viewer_count": 0
      },
      {
        "room_id": "room_uuid_003",
        "live_status": "scheduled",
        "current_session_id": "session_uuid_3",
        "viewer_count": 0
      }
    ],
    "timestamp": "2025-10-15T11:05:00Z"
  }
  ```
* **å¤±è´¥å“åº”ç¤ºä¾‹** (`400 Bad Request` - å‚æ•°é”™è¯¯):
  ```json
  {
    "code": 4001,
    "message": "å‚æ•°æ ¡éªŒå¤±è´¥",
    "data": {
      "field": "room_ids",
      "error": "æœ€å¤šæ”¯æŒä¸€æ¬¡æŸ¥è¯¢100ä¸ªç›´æ’­é—´"
    },
    "timestamp": "2025-10-15T11:05:05Z"
  }
  ```
* **å®ç°æµç¨‹æè¿°**:
  1. å®šä¹‰ FastAPI è·¯ç”±å‡½æ•°ï¼Œæ¥æ”¶ Pydantic æ¨¡å‹ `BatchStatusRequest` å’Œæ•°æ®åº“ä¼šè¯ `db`ã€‚
  2. **JWT TokenéªŒè¯**: é€šè¿‡ `Depends(get_current_user)` éªŒè¯ç”¨æˆ·èº«ä»½ã€‚
  3. **å‚æ•°éªŒè¯**: æ£€æŸ¥ `room_ids` åˆ—è¡¨é•¿åº¦ä¸è¶…è¿‡100ï¼ˆé˜²æ­¢æ€§èƒ½é—®é¢˜ï¼‰ã€‚
  4. **æ‰¹é‡æŸ¥è¯¢ç›´æ’­é—´**: æŸ¥è¯¢ `live_rooms` è¡¨ç¡®è®¤æ‰€æœ‰ç›´æ’­é—´å­˜åœ¨ã€‚
  5. **æ‰¹é‡æŸ¥è¯¢åœºæ¬¡çŠ¶æ€**: 
     - æŸ¥è¯¢ `live_sessions` è¡¨ï¼Œå¯¹æ¯ä¸ª `room_id`ï¼Œè·å–æœ€æ–°çš„åœºæ¬¡ã€‚
     - ä¼˜å…ˆè¿”å› `status = 'live'` çš„åœºæ¬¡ï¼Œå…¶æ¬¡æ˜¯ `status = 'scheduled'`ã€‚
  6. **æ‰¹é‡æŸ¥è¯¢è§‚çœ‹äººæ•°**: å¯¹äº `status = 'live'` çš„åœºæ¬¡ï¼ŒæŸ¥è¯¢ `session_statistics` è¡¨è·å– `current_viewer_count`ã€‚
  7. **ç»„è£…ç»“æœ**: ä¸ºæ¯ä¸ªç›´æ’­é—´æ„å»ºçŠ¶æ€å¯¹è±¡ã€‚
  8. **æ—¥å¿—è®°å½•**: è®°å½•DEBUGçº§åˆ«æ—¥å¿—ï¼ŒåŒ…å«æŸ¥è¯¢çš„ç›´æ’­é—´æ•°é‡ã€‚
  9. **æ„å»ºå“åº”**: è¿”å›æ‰¹é‡çŠ¶æ€åˆ—è¡¨ã€‚

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šPydantic Schema å®šä¹‰ (æ–°å¢)

### ä¸“é¢˜ç›¸å…³ Schema

```python
from pydantic import BaseModel, Field, validator
from typing import Optional, List
from datetime import datetime
import uuid

# ===== æšä¸¾ç±»å‹ =====
from enum import Enum

class TopicStatus(str, Enum):
    """ä¸“é¢˜çŠ¶æ€æšä¸¾"""
    DRAFT = "draft"
    PUBLISHED = "published"
    ARCHIVED = "archived"

# ===== ä¸“é¢˜ Schema =====
class TopicBase(BaseModel):
    """ä¸“é¢˜åŸºç¡€Schema"""
    title: str = Field(..., min_length=1, max_length=100, description="ä¸“é¢˜æ ‡é¢˜")
    description: Optional[str] = Field(None, description="ä¸“é¢˜æè¿°")
    banner_url: Optional[str] = Field(None, max_length=255, description="æ¨ªå¹…å›¾URL")
    status: TopicStatus = Field(TopicStatus.DRAFT, description="ä¸“é¢˜çŠ¶æ€")

class TopicCreate(TopicBase):
    """åˆ›å»ºä¸“é¢˜è¯·æ±‚Schema"""
    pass

class TopicUpdate(BaseModel):
    """æ›´æ–°ä¸“é¢˜è¯·æ±‚Schema"""
    title: Optional[str] = Field(None, min_length=1, max_length=100)
    description: Optional[str] = None
    banner_url: Optional[str] = Field(None, max_length=255)
    status: Optional[TopicStatus] = None

class TopicInDB(TopicBase):
    """æ•°æ®åº“ä¸­çš„ä¸“é¢˜Schema"""
    id: uuid.UUID
    user_id: uuid.UUID
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True

class TopicResponse(TopicInDB):
    """ä¸“é¢˜å“åº”Schema"""
    pass

# ===== åˆ†ç±» Schema =====
class CategoryBase(BaseModel):
    """åˆ†ç±»åŸºç¡€Schema"""
    name: str = Field(..., min_length=1, max_length=50, description="åˆ†ç±»åç§°")
    sort_order: int = Field(0, ge=0, description="æ’åºé¡ºåº")

class CategoryCreate(CategoryBase):
    """åˆ›å»ºåˆ†ç±»è¯·æ±‚Schema"""
    pass

class CategoryUpdate(BaseModel):
    """æ›´æ–°åˆ†ç±»è¯·æ±‚Schema"""
    name: Optional[str] = Field(None, min_length=1, max_length=50)
    sort_order: Optional[int] = Field(None, ge=0)

class CategoryInDB(CategoryBase):
    """æ•°æ®åº“ä¸­çš„åˆ†ç±»Schema"""
    id: uuid.UUID
    topic_id: uuid.UUID
    created_at: datetime
    updated_at: datetime
    
    class Config:
        from_attributes = True

class CategoryResponse(CategoryInDB):
    """åˆ†ç±»å“åº”Schema"""
    pass

# ===== å…³è”ç®¡ç† Schema =====
class RoomAssociation(BaseModel):
    """å•ä¸ªç›´æ’­é—´å…³è”Schema"""
    room_id: uuid.UUID
    sort_order: int = Field(0, ge=0)

class AddRoomsRequest(BaseModel):
    """æ·»åŠ ç›´æ’­é—´åˆ°åˆ†ç±»è¯·æ±‚Schema"""
    rooms: List[RoomAssociation] = Field(..., min_items=1, max_items=50)
    
    @validator('rooms')
    def validate_unique_room_ids(cls, v):
        """éªŒè¯room_idå”¯ä¸€æ€§"""
        room_ids = [r.room_id for r in v]
        if len(room_ids) != len(set(room_ids)):
            raise ValueError("room_id ä¸èƒ½é‡å¤")
        return v

class UpdateRoomSortRequest(BaseModel):
    """æ›´æ–°ç›´æ’­é—´æ’åºè¯·æ±‚Schema"""
    rooms: List[RoomAssociation] = Field(..., min_items=1, max_items=100)

class RemoveRoomsRequest(BaseModel):
    """ç§»é™¤ç›´æ’­é—´è¯·æ±‚Schema"""
    room_ids: List[uuid.UUID] = Field(..., min_items=1, max_items=50)

class BatchStatusRequest(BaseModel):
    """æ‰¹é‡æŸ¥è¯¢çŠ¶æ€è¯·æ±‚Schema"""
    room_ids: List[uuid.UUID] = Field(..., min_items=1, max_items=100)

# ===== èšåˆé¡µå“åº” Schema =====
class RoomInCategory(BaseModel):
    """åˆ†ç±»ä¸‹çš„ç›´æ’­é—´Schema"""
    id: uuid.UUID
    title: str
    cover_url: Optional[str]
    live_status: str
    start_time: Optional[datetime]
    heat: int

class CategoryWithRooms(BaseModel):
    """åŒ…å«ç›´æ’­é—´åˆ—è¡¨çš„åˆ†ç±»Schema"""
    id: uuid.UUID
    name: str
    sort_order: int
    rooms: List[RoomInCategory]

class TopicDetailResponse(TopicInDB):
    """ä¸“é¢˜è¯¦æƒ…å“åº”Schemaï¼ˆåŒ…å«å±‚çº§åŒ–æ•°æ®ï¼‰"""
    categories: List[CategoryWithRooms]
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šå¼‚å¸¸ç±»å®šä¹‰ (æ–°å¢)

```python
from fastapi import HTTPException, status

class TopicNotFoundException(HTTPException):
    """ä¸“é¢˜ä¸å­˜åœ¨å¼‚å¸¸"""
    def __init__(self, topic_id: str):
        super().__init__(
            status_code=status.HTTP_404_NOT_FOUND,
            detail={
                "code": 2001,
                "message": "èµ„æºä¸å­˜åœ¨",
                "data": {"resource": "Topic", "id": topic_id}
            }
        )

class CategoryNotFoundException(HTTPException):
    """åˆ†ç±»ä¸å­˜åœ¨å¼‚å¸¸"""
    def __init__(self, category_id: str):
        super().__init__(
            status_code=status.HTTP_404_NOT_FOUND,
            detail={
                "code": 2001,
                "message": "èµ„æºä¸å­˜åœ¨",
                "data": {"resource": "TopicCategory", "id": category_id}
            }
        )

class TopicPermissionDeniedException(HTTPException):
    """ä¸“é¢˜æƒé™ä¸è¶³å¼‚å¸¸"""
    def __init__(self, action: str = "æ“ä½œ"):
        super().__init__(
            status_code=status.HTTP_403_FORBIDDEN,
            detail={
                "code": 2003,
                "message": "æ“ä½œè¢«ç¦æ­¢",
                "data": {
                    "error": f"æ‚¨æ²¡æœ‰æƒé™è¿›è¡Œæ­¤{action}",
                    "reason": "ä»…ä¸“é¢˜åˆ›å»ºè€…å¯æ“ä½œ"
                }
            }
        )

class RoomAlreadyAssociatedException(HTTPException):
    """ç›´æ’­é—´å·²å…³è”å¼‚å¸¸"""
    def __init__(self, room_id: str, category_id: str):
        super().__init__(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail={
                "code": 4001,
                "message": "å‚æ•°æ ¡éªŒå¤±è´¥",
                "data": {
                    "error": "è¯¥ç›´æ’­é—´å·²å…³è”åˆ°æ­¤åˆ†ç±»",
                    "room_id": room_id,
                    "category_id": category_id
                }
            }
        )
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šæ—¥å¿—è§„èŒƒ (æ–°å¢)

### æ—¥å¿—è®°å½•è¦æ±‚

#### **1. æ—¥å¿—çº§åˆ«ä½¿ç”¨è§„èŒƒ**
- **ERROR**: ä¸“é¢˜/åˆ†ç±»åˆ›å»ºå¤±è´¥ã€æ•°æ®åº“æ“ä½œå¤±è´¥ã€æƒé™éªŒè¯å¤±è´¥ç­‰å…³é”®é”™è¯¯
- **WARNING**: åˆ é™¤ä¸“é¢˜/åˆ†ç±»æ“ä½œã€æ‰¹é‡æ“ä½œéƒ¨åˆ†å¤±è´¥
- **INFO**: æ‰€æœ‰åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ“ä½œçš„æˆåŠŸè®°å½•
- **DEBUG**: æŸ¥è¯¢æ“ä½œã€æ•°æ®éªŒè¯è¿‡ç¨‹ã€æƒé™æ£€æŸ¥è¯¦ç»†ä¿¡æ¯

#### **2. æ—¥å¿—å†…å®¹è¦æ±‚**

**åˆ›å»ºæ“ä½œæ—¥å¿—ç¤ºä¾‹ï¼š**
```python
logger.info(
    f"ä¸“é¢˜åˆ›å»ºæˆåŠŸ: user_id={user_id}, topic_id={topic.id}, "
    f"title={topic.title}, status={topic.status}"
)
```

**æ›´æ–°æ“ä½œæ—¥å¿—ç¤ºä¾‹ï¼š**
```python
logger.info(
    f"ä¸“é¢˜æ›´æ–°æˆåŠŸ: user_id={user_id}, topic_id={topic_id}, "
    f"updated_fields={list(update_data.keys())}"
)
```

**åˆ é™¤æ“ä½œæ—¥å¿—ç¤ºä¾‹ï¼š**
```python
logger.warning(
    f"ä¸“é¢˜åˆ é™¤: user_id={user_id}, topic_id={topic_id}, "
    f"categories_count={categories_count}, rooms_count={rooms_count}"
)
```

**æƒé™éªŒè¯å¤±è´¥æ—¥å¿—ç¤ºä¾‹ï¼š**
```python
logger.error(
    f"æƒé™éªŒè¯å¤±è´¥: user_id={user_id}, topic_id={topic_id}, "
    f"topic_owner={topic.user_id}, action=update_topic"
)
```

**æŸ¥è¯¢æ“ä½œæ—¥å¿—ç¤ºä¾‹ï¼š**
```python
logger.debug(
    f"ä¸“é¢˜åˆ—è¡¨æŸ¥è¯¢: user_id={user_id}, page={page}, size={size}, "
    f"filters={filters}, total={total}"
)
```

---

## ç¬¬å…­éƒ¨åˆ†ï¼šæµ‹è¯•ç”¨ä¾‹è®¾è®¡ (æ–°å¢)

### å•å…ƒæµ‹è¯•è¦†ç›–

#### **CRUD å±‚æµ‹è¯•**
1. `test_create_topic_success`: æµ‹è¯•æˆåŠŸåˆ›å»ºä¸“é¢˜
2. `test_get_topic_by_id_success`: æµ‹è¯•æ ¹æ®IDæŸ¥è¯¢ä¸“é¢˜
3. `test_update_topic_success`: æµ‹è¯•æ›´æ–°ä¸“é¢˜
4. `test_delete_topic_success`: æµ‹è¯•åˆ é™¤ä¸“é¢˜ï¼ˆéªŒè¯çº§è”åˆ é™¤ï¼‰
5. `test_create_category_success`: æµ‹è¯•åˆ›å»ºåˆ†ç±»
6. `test_get_categories_by_topic_id`: æµ‹è¯•æŸ¥è¯¢ä¸“é¢˜ä¸‹çš„åˆ†ç±»åˆ—è¡¨
7. `test_add_room_to_category_success`: æµ‹è¯•æ·»åŠ ç›´æ’­é—´å…³è”
8. `test_remove_room_from_category_success`: æµ‹è¯•ç§»é™¤ç›´æ’­é—´å…³è”

#### **Service å±‚æµ‹è¯•**
1. `test_create_topic_with_user_id`: æµ‹è¯•åˆ›å»ºä¸“é¢˜æ—¶è‡ªåŠ¨å…³è”user_id
2. `test_update_topic_permission_check`: æµ‹è¯•æ›´æ–°ä¸“é¢˜æ—¶çš„æƒé™éªŒè¯
3. `test_delete_topic_permission_check`: æµ‹è¯•åˆ é™¤ä¸“é¢˜æ—¶çš„æƒé™éªŒè¯
4. `test_get_topic_detail_with_categories`: æµ‹è¯•è·å–å±‚çº§åŒ–ä¸“é¢˜è¯¦æƒ…
5. `test_calculate_room_heat_value`: æµ‹è¯•heatå€¼è®¡ç®—é€»è¾‘
6. `test_batch_get_room_status`: æµ‹è¯•æ‰¹é‡æŸ¥è¯¢ç›´æ’­é—´çŠ¶æ€

#### **API å±‚é›†æˆæµ‹è¯•**
1. `test_create_topic_without_token`: æµ‹è¯•æœªè®¤è¯æ—¶åˆ›å»ºä¸“é¢˜ï¼ˆåº”è¿”å›401ï¼‰
2. `test_create_topic_with_valid_token`: æµ‹è¯•è®¤è¯ååˆ›å»ºä¸“é¢˜æˆåŠŸ
3. `test_get_published_topics_list`: æµ‹è¯•è·å–å·²å‘å¸ƒä¸“é¢˜åˆ—è¡¨
4. `test_update_other_user_topic`: æµ‹è¯•ä¿®æ”¹ä»–äººä¸“é¢˜ï¼ˆåº”è¿”å›403ï¼‰
5. `test_delete_topic_cascade`: æµ‹è¯•åˆ é™¤ä¸“é¢˜åéªŒè¯åˆ†ç±»å’Œå…³è”è¢«çº§è”åˆ é™¤
6. `test_add_nonexistent_room_to_category`: æµ‹è¯•æ·»åŠ ä¸å­˜åœ¨çš„ç›´æ’­é—´ï¼ˆåº”è¿”å›400ï¼‰
7. `test_get_topic_detail_structure`: æµ‹è¯•ä¸“é¢˜è¯¦æƒ…è¿”å›çš„æ•°æ®ç»“æ„å®Œæ•´æ€§
8. `test_batch_status_api_performance`: æµ‹è¯•æ‰¹é‡çŠ¶æ€æŸ¥è¯¢çš„æ€§èƒ½

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæ€»ç»“

### ä¿®æ”¹æ¸…å•

#### **æ•°æ®åº“è®¾è®¡ä¿®æ”¹**
âœ… 1. å°† `topics.status` å­—æ®µä» VARCHAR æ”¹ä¸º ENUM ç±»å‹
âœ… 2. ä¸º `topics` è¡¨æ·»åŠ  `user_id` å­—æ®µå’Œç´¢å¼•
âœ… 3. ä¸º `topic_categories` è¡¨æ·»åŠ  `updated_at` å­—æ®µ
âœ… 4. ä¸º `topic_category_rooms` è¡¨æ·»åŠ  `updated_at` å­—æ®µ
âœ… 5. æ·»åŠ æ€§èƒ½ä¼˜åŒ–ç´¢å¼•ï¼ˆstatus, created_at, sort_orderç­‰ï¼‰

#### **API æ¥å£ä¿®æ”¹**
âœ… 6. ä¸ºæ‰€æœ‰ä¸“é¢˜APIæ·»åŠ å®Œæ•´çš„æƒé™æ§åˆ¶è§„åˆ™è¯´æ˜
âœ… 7. ä¸ºæ¯ä¸ªAPIæ¥å£æ·»åŠ è¯¦ç»†çš„å®ç°æµç¨‹æè¿°ï¼ˆ9-10æ­¥ï¼‰
âœ… 8. ä¿®æ­£åˆ†ç±»åˆ—è¡¨æ¥å£ï¼Œä½¿ç”¨æ ‡å‡†åˆ†é¡µå“åº”æ ¼å¼
âœ… 9. ä¸ºä¸“é¢˜è¯¦æƒ…æ¥å£æ·»åŠ heatå­—æ®µè®¡ç®—é€»è¾‘è¯´æ˜
âœ… 10. ä¼˜åŒ–æ‰¹é‡æ·»åŠ ç›´æ’­é—´æ¥å£ï¼Œæ”¯æŒæŒ‡å®šæ’åº
âœ… 11. ä¿®æ­£æ›´æ–°æ’åºæ¥å£è·¯å¾„ä¸º `/rooms/sort-order`
âœ… 12. ä¸ºä¸“é¢˜åˆ—è¡¨æ¥å£æ·»åŠ statuså’Œuser_idæŸ¥è¯¢å‚æ•°
âœ… 13. æ–°å¢"è·å–ç›´æ’­é—´å…³è”çš„ä¸“é¢˜åˆ—è¡¨"æ¥å£
âœ… 14. æ–°å¢"æ‰¹é‡è·å–ç›´æ’­é—´çŠ¶æ€"æ¥å£

#### **æ–‡æ¡£è§„èŒƒä¿®æ”¹**
âœ… 15. æ·»åŠ å®Œæ•´çš„Pydantic Schemaå®šä¹‰
âœ… 16. æ·»åŠ ä¸“é¢˜ç›¸å…³çš„å¼‚å¸¸ç±»å®šä¹‰
âœ… 17. æ·»åŠ ä¸“é¢˜åŠŸèƒ½çš„æ—¥å¿—è®°å½•è§„èŒƒ
âœ… 18. æ·»åŠ æµ‹è¯•ç”¨ä¾‹è®¾è®¡æŒ‡å—

### æ–‡æ¡£ä¸€è‡´æ€§éªŒè¯

æœ¬ä¿®æ­£ç‰ˆæ–‡æ¡£å·²ä¸ **ã€Šç›´æ’­æ ¸å¿ƒåŠŸèƒ½è®¾è®¡æ–‡æ¡£v4-å¢åŠ ä¸“é¢˜.mdã€‹** ä¿æŒå®Œå…¨ä¸€è‡´ï¼š

#### **æ•°æ®åº“è®¾è®¡è§„èŒƒ**
âœ… UUIDä¸»é”®ï¼ˆåº”ç”¨å±‚ç”Ÿæˆï¼‰
âœ… TIMESTAMPTZæ—¶é—´æˆ³ï¼ˆUTCå­˜å‚¨ï¼‰
âœ… ENUMç±»å‹ä¿è¯æ•°æ®å‡†ç¡®æ€§
âœ… user_idé€šè¿‡JWT Tokenåº”ç”¨å±‚éªŒè¯
âœ… ON DELETE CASCADEçº§è”åˆ é™¤
âœ… å®Œæ•´çš„ç´¢å¼•è®¾è®¡

#### **APIæ¥å£è§„èŒƒ**
âœ… ç»Ÿä¸€å“åº”ç»“æ„ï¼ˆcode, message, data, timestampï¼‰
âœ… æ ‡å‡†åˆ†é¡µæ ¼å¼ï¼ˆtotal, page, size, itemsï¼‰
âœ… HTTPçŠ¶æ€ç çº¦å®šï¼ˆ200, 400, 401, 403, 404, 500ï¼‰
âœ… ä¸šåŠ¡çŠ¶æ€ç çº¦å®šï¼ˆ200æˆåŠŸ, 2xxxä¸šåŠ¡é”™è¯¯, 4xxxå‚æ•°é”™è¯¯ï¼‰
âœ… å®Œæ•´çš„å®ç°æµç¨‹æè¿°ï¼ˆJWTéªŒè¯ã€æƒé™æ£€æŸ¥ã€æ—¥å¿—è®°å½•ç­‰ï¼‰

#### **å‘½åè§„èŒƒ**
âœ… è¡¨åï¼šä¸‹åˆ’çº¿å‘½åï¼ˆtopics, topic_categoriesï¼‰
âœ… å­—æ®µåï¼šä¸‹åˆ’çº¿å‘½åï¼ˆuser_id, sort_orderï¼‰
âœ… ç±»åï¼šå¤§é©¼å³°å‘½åï¼ˆTopicCreate, CategoryResponseï¼‰
âœ… å‡½æ•°åï¼šä¸‹åˆ’çº¿å‘½åï¼ˆcreate_topic, get_topic_detailï¼‰
âœ… APIè·¯å¾„ï¼šå°å†™+è¿å­—ç¬¦ï¼ˆ/api/v1/topics, /topic-categoriesï¼‰

#### **å¼‚å¸¸å¤„ç†è§„èŒƒ**
âœ… ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ä¸­é—´ä»¶
âœ… è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼ˆç»§æ‰¿è‡ªHTTPExceptionï¼‰
âœ… è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•
âœ… ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼

#### **æ—¥å¿—è§„èŒƒ**
âœ… æ ‡å‡†æ—¥å¿—çº§åˆ«ï¼ˆERROR, WARNING, INFO, DEBUGï¼‰
âœ… å®Œæ•´çš„æ—¥å¿—å†…å®¹ï¼ˆåŒ…å«user_idã€resource_idã€actionç­‰ï¼‰
âœ… å…³é”®æ“ä½œçš„æ—¥å¿—è®°å½•è¦æ±‚

---

## é™„å½•ï¼šä¿®æ”¹å‰åå¯¹æ¯”

### A. DDLå¯¹æ¯”

**ä¿®æ”¹å‰:**
```sql
status VARCHAR(20) NOT NULL DEFAULT 'draft'
```

**ä¿®æ”¹å:**
```sql
CREATE TYPE topic_status AS ENUM ('draft', 'published', 'archived');
status topic_status NOT NULL DEFAULT 'draft'
```

### B. å“åº”æ ¼å¼å¯¹æ¯”

**ä¿®æ”¹å‰ï¼ˆåˆ†ç±»åˆ—è¡¨ï¼‰:**
```json
{
  "code": 200,
  "data": [
    { "id": "...", "name": "äº‘å—çœ" }
  ]
}
```

**ä¿®æ”¹å:**
```json
{
  "code": 200,
  "data": {
    "total": 5,
    "page": 1,
    "size": 10,
    "items": [
      { "id": "...", "name": "äº‘å—çœ", "sort_order": 1 }
    ]
  }
}
```

### C. æƒé™æ§åˆ¶å¯¹æ¯”

**ä¿®æ”¹å‰:** æ— æ˜ç¡®è¯´æ˜

**ä¿®æ”¹å:** 
- åˆ›å»ºä¸“é¢˜ï¼šæ‰€æœ‰ç™»å½•ç”¨æˆ·
- ä¿®æ”¹/åˆ é™¤ä¸“é¢˜ï¼šä»…åˆ›å»ºè€…æœ¬äººï¼ˆuser_idåŒ¹é…ï¼‰
- æ‰€æœ‰æ“ä½œéƒ½éœ€è¦JWT Tokenè®¤è¯

---

**æ–‡æ¡£ç‰ˆæœ¬**: V1.0 (ä¿®æ­£ç‰ˆ)  
**ä¿®è®¢å®Œæˆæ—¥æœŸ**: 2025-10-15  
**ç¬¦åˆè§„èŒƒ**: ç›´æ’­æ ¸å¿ƒåŠŸèƒ½è®¾è®¡æ–‡æ¡£ V3.2 å…¨éƒ¨è§„èŒƒ  
**å®¡æŸ¥é€šè¿‡**: âœ… æ‰€æœ‰é—®é¢˜å·²ä¿®å¤

