# 静态直播展示站点搭建提示词（Vue 3 + Vite + CSV 数据源）

## 角色与目标

你是一名资深 Vue 3 前端开发工程师，精通 Vite、TypeScript、Artplayer 和 HLS.js。现在需要你创建一个**完全独立的静态直播展示站点**，该站点将：

1.  **不依赖后端和数据库**，所有数据从 CSV 文件读取
2.  **使用 Vue 3 + Vite** 作为开发框架，最大化复用现有组件代码
3.  **实现两个页面**：列表页（展示直播卡片）和播放页（播放 HLS 直播流）
4.  **UI 和逻辑直接复用**现有的 `VenueDisplayPage.vue` 和 `LiveView.vue` 页面
5.  **最终产物**为纯静态文件（HTML + JS + CSS），可部署到任意静态服务器或 CDN

---

## 核心优势

### 为什么选择 Vue 方案

✅ **代码复用率 90%+**：直接复制现有 .vue 文件，只需修改数据获取逻辑
✅ **开发时间减半**：预计 2-3 小时完成（相比原生 JS 方案的 4-6 小时）
✅ **技术栈一致**：保持与主项目相同的开发体验
✅ **组件完全复用**：`VideoPlayer.vue`、时间格式化函数、样式等零修改

---

## 项目需求说明

### 项目结构

```
live-static-viewer/
├── public/
│   ├── data.csv
│   ├── banner.jpg
│   └── logo.png
├── src/
│   ├── App.vue
│   ├── main.ts
│   ├── router/
│   │   └── index.ts
│   ├── pages/
│   │   ├── ListView.vue
│   │   └── PlayerView.vue
│   ├── components/
│   │   └── VideoPlayer.vue
│   ├── utils/
│   │   ├── csv.ts
│   │   └── datetime.ts
│   └── styles/
│       └── main.css
├── index.html
├── package.json
├── tsconfig.json
└── vite.config.ts
```

### 核心功能

#### 1. 列表页（ListView.vue）

**功能**：
- 从 `public/data.csv` 读取直播间列表数据
- UI 完全复用 `VenueDisplayPage.vue` 的布局和样式
- 点击卡片跳转到播放页

#### 2. 播放页（PlayerView.vue）

**功能**：
- 根据路由参数 `id` 从 CSV 中加载直播数据
- UI 和播放器完全复用 `LiveView.vue`
- 使用已有的 `VideoPlayer.vue` 组件播放 m3u8 流

### CSV 数据格式

文件路径：`public/data.csv`

```csv
id,title,thumbnail,date,views,status,m3u8_url,description
1,面对面第二十期：专题讨论,https://example.com/thumb1.jpg,2025-10-30 20:00:00,408,live,https://cdn.example.com/stream1.m3u8,胰腺手术新概念的专题讨论
2,面对面第二十七期：解腹论道,https://example.com/thumb2.jpg,2025-05-29 20:00:00,4978,ended,https://cdn.example.com/stream2.m3u8,SPN指南解读
3,面对面第二十六期：解腹论道,https://example.com/thumb3.jpg,2025-04-15 19:00:00,3521,ended,https://cdn.example.com/stream3.m3u8,SPT指南解读
```

---

## 任务一：项目初始化

### 1. 创建 Vue + TypeScript 项目

```bash
# 创建项目（选择 vue-ts 模板）
npm create vite@latest live-static-viewer -- --template vue-ts
cd live-static-viewer

# 安装核心依赖
npm install vue@^3.4.0 vue-router@^4.3.0 artplayer@^5.3.0 hls.js@^1.5.0 papaparse@^5.4.0 element-plus@^2.11.3

# 安装开发依赖
npm install -D @vitejs/plugin-vue@^5.0.0 @types/papaparse@^5.3.0 typescript@^5.4.0 vite@^5.2.0
```

### 2. 配置 `vite.config.ts`

```typescript
import { defineConfig } from 'vite';
import vue from '@vitejs/plugin-vue';
import path from 'path';

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    }
  },
  base: './',
  build: {
    outDir: 'dist',
    assetsDir: 'assets'
  },
  server: {
    port: 5173,
    open: true
  }
});
```

---

## 任务二：复制并创建核心文件

### 1. 复制工具函数

**创建 `src/utils/csv.ts`**

```typescript
import Papa from 'papaparse';

export interface LiveRecord {
  id: string;
  title: string;
  thumbnail: string;
  date: string;
  views: number;
  status: 'scheduled' | 'live' | 'ended';
  m3u8_url: string;
  description: string;
}

let cachedData: LiveRecord[] | null = null;

export async function loadCSV(): Promise<LiveRecord[]> {
  if (cachedData) return cachedData;

  const response = await fetch('/data.csv');
  const csvText = await response.text();

  return new Promise((resolve, reject) => {
    Papa.parse<LiveRecord>(csvText, {
      header: true,
      skipEmptyLines: true,
      dynamicTyping: true,
      complete: (results) => {
        cachedData = results.data;
        resolve(cachedData);
      },
      error: (error) => reject(error)
    });
  });
}

export async function getRecordById(id: string): Promise<LiveRecord | null> {
  const records = await loadCSV();
  return records.find(r => r.id.toString() === id.toString()) || null;
}
```

**创建 `src/utils/datetime.ts`**

```typescript
export function formatTime(timeStr: string): string {
  if (!timeStr) return '';
  let s = String(timeStr).trim();
  s = s.replace(/\s+/g, 'T');
  s = s.replace(/\.(\d{1,6})/, '');
  s = s.replace(/Z$/i, '');
  if (s.includes('+')) s = s.split('+')[0];
  s = s.replace('T', ' ');
  
  const candidates = [s, s.replace(/-/g, '/')];
  
  for (const v of candidates) {
    const d = new Date(v);
    if (!isNaN(d.getTime())) {
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      const hh = String(d.getHours()).padStart(2, '0');
      const mm = String(d.getMinutes()).padStart(2, '0');
      const ss = String(d.getSeconds()).padStart(2, '0');
      return `${y}-${m}-${day} ${hh}:${mm}:${ss}`;
    }
  }
  return s.split(' ')[0] || s;
}
```

### 2. 复制 Vue 组件
- **创建 `src/components/VideoPlayer.vue`**：直接复制现有项目中的同名文件。
- **创建 `src/pages/ListView.vue`**：复制 `VenueDisplayPage.vue` 的全部内容。
- **创建 `src/pages/PlayerView.vue`**：复制 `LiveView.vue` 的全部内容。

---

## 任务三：修改数据获取逻辑

### 1. 修改 `ListView.vue`

**将 API 调用替换为 CSV 读取**：

```vue
<script setup lang="ts">
import { ref, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import { loadCSV, LiveRecord } from '@/utils/csv'; // 引入 CSV 工具
import { formatTime } from '@/utils/datetime';

const router = useRouter();
const records = ref<LiveRecord[]>([]);

onMounted(async () => {
  // 替换原有 API 请求
  records.value = await loadCSV();
});

const goLive = (id: string) => {
  router.push({ name: 'player', params: { id } });
};

// ... 其他 statusText, statusType, getCoverSrc 函数保持不变 ...
</script>

<template>
  <!-- 模板部分将 v-for 的源从 store 改为 records -->
  <el-row :gutter="10">
    <el-col v-for="room in records" :key="room.id" :xs="24" :sm="24" :md="24" :lg="24">
      <el-card shadow="hover" class="venue-card dense" @click="goLive(room.id)">
        <!-- ... 卡片内部结构不变 ... -->
      </el-card>
    </el-col>
  </el-row>
</template>
```

### 2. 修改 `PlayerView.vue`

**将 API 调用替换为 CSV 读取**：

```vue
<script setup lang="ts">
import { ref, onMounted, computed } from 'vue';
import { useRoute } from 'vue-router';
import { getRecordById, LiveRecord } from '@/utils/csv'; // 引入 CSV 工具
import VideoPlayer from '@/components/VideoPlayer.vue';

const route = useRoute();
const record = ref<LiveRecord | null>(null);

// 播放器 URL
const playerSourceUrl = computed(() => {
  if (!record.value) return null;
  // 直播/回放逻辑简化：直接使用 m3u8_url
  return record.value.m3u8_url;
});

onMounted(async () => {
  const id = route.params.id as string;
  // 替换原有 API 请求
  record.value = await getRecordById(id);
});

// ... 其他 getStatusText, formatTime 等函数保持不变 ...
</script>

<template>
  <!-- 模板部分将数据源从 store 改为 record -->
  <div v-if="record">
    <el-card shadow="never" class="top-info-bar">
      <el-text class="live-title">{{ record.title }}</el-text>
      <!-- ... 其他信息 ... -->
    </el-card>
    <el-card class="video-player-area" shadow="never">
      <VideoPlayer :src="playerSourceUrl" />
    </el-card>
    <!-- ... 其他介绍部分 ... -->
  </div>
</template>
```

---

## 任务四：配置路由

**文件路径：`src/router/index.ts`**

```typescript
import { createRouter, createWebHashHistory } from 'vue-router';
import ListView from '@/pages/ListView.vue';
import PlayerView from '@/pages/PlayerView.vue';

const routes = [
  {
    path: '/',
    name: 'list',
    component: ListView,
  },
  {
    path: '/player/:id',
    name: 'player',
    component: PlayerView,
  },
];

const router = createRouter({
  history: createWebHashHistory(),
  routes,
});

export default router;
```

---

## 任务五：入口文件配置

**文件路径：`src/main.ts`**

```typescript
import { createApp } from 'vue';
import App from './App.vue';
import router from './router';
import './styles/main.css'; // 可选的全局样式

const app = createApp(App);
app.use(router);
app.mount('#app');
```

**文件路径：`src/App.vue`**

```vue
<template>
  <router-view />
</template>
```

---

## 开发与部署

### 开发
```bash
npm run dev
```
访问 `http://localhost:5173`

### 打包
```bash
npm run build
```
生成的 `dist/` 目录即为最终的静态站点。

### 部署
将 `dist/` 目录上传到任意静态服务器或 CDN。


